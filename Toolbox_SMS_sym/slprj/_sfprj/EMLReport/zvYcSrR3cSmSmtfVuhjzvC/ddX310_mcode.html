<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="118,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T27U3">u0</span>,<span class="var type1" id="S3T3U4">r_com</span>] = ddX(<span class="var type1" id="S4T4U7">R0</span>,<span class="var type1" id="S5T3U8">r0</span>,<span class="var type1" id="S6T1U9">qm</span>,<span class="var type1" id="S7T5U10">is_captured</span>,<span class="var type1" id="S8T5U11">moment_system</span>,<span class="var type2" id="S9T94V5U12">robot_post_sim</span>,<span class="var type2" id="S10T6V1U13">robot_pre_sim</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="118,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% :inputs:</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%   * R0 -- Rotation matrix from the base-link CCS to the inertial CCS -- [3x3].</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%   * r0 -- Position of the base-link center-of-mass with respect to the origin of the inertial frame,</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%projected in the inertial CCS -- [3x1].</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%   * qm -- Displacements of the active joints -- [n_qx1].</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%   * eta -- Modal</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%   * u0 -- Base-link velocities [\omega,rdot]. The angular velocity is projected in the body-fixed CCS,</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,10" id="srcline10">10</a></span><span class="line"><span class="comment">%while the linear velocity is projected in the inertial CCS -- [6x1].</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,11" id="srcline11">11</a></span><span class="line"><span class="comment">%   * um -- Joint velocities -- [n_qx1].</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,12" id="srcline12">12</a></span><span class="line"><span class="comment">%   * robot -- Robot model (see :doc:`/Tutorial_Robot`).</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,14" id="srcline14">14</a></span><span class="line"><span class="comment">%--- System_dimension ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T5:U10"><span class="var type1" id="S11T5U16">dim_0</span> = <span class="mxinfo " id="T5:U12">6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,19" id="srcline19">19</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S7T5U20">is_captured</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T94:U14"><span class="var type1" id="S12T94U23">robot_sim</span> = <span class="var type1" id="S9T94U24">robot_post_sim</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,21" id="srcline21">21</a></span><span class="line">    <span class="comment">%--- Kinematics ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,22" id="srcline22">22</a></span><span class="line">    <span class="comment">%Kinematics</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,23" id="srcline23">23</a></span><span class="line">    [<span class="mxinfo " id="T98:U17">~</span>,<span class="var type1" id="S13T98U29">RL</span>,<span class="mxinfo " id="T99:U19">~</span>,<span class="var type1" id="S14T99U31">rL</span>,<span class="var type1" id="S15T99U32">e</span>,<span class="var type1" id="S16T99U33">g</span>]    =   <span class="fcn" id="F311N14:B35">Kinematics</span>(<span class="var type1" id="S4T4U36">R0</span>,<span class="var type1" id="S5T3U37">r0</span>,<span class="var type1" id="S6T1U38">qm</span>,<span class="var type1" id="S12T94U39">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,24" id="srcline24">24</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="118,25" id="srcline25">25</a></span><span class="line">    <span class="comment">%Diferential Kinematics</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,26" id="srcline26">26</a></span><span class="line">    [<span class="var type1" id="S18T100U43">Bij</span>,<span class="var type1" id="S19T101U44">Bi0</span>,<span class="var type1" id="S20T27U45">P0</span>,<span class="var type1" id="S21T33U46">pm</span>]     =   <span class="fcn" id="F312N5:B48">DiffKinematics</span>(<span class="var type1" id="S4T4U49">R0</span>,<span class="var type1" id="S5T3U50">r0</span>,<span class="var type1" id="S14T99U51">rL</span>,<span class="var type1" id="S15T99U52">e</span>,<span class="var type1" id="S16T99U53">g</span>,<span class="var type1" id="S12T94U54">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,27" id="srcline27">27</a></span><span class="line">    <span class="comment">%Velocities</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,28" id="srcline28">28</a></span><span class="line">    <span class="comment">%Inertias in inertial frames</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,29" id="srcline29">29</a></span><span class="line">    [<span class="var type1" id="S23T4U58">I0</span>,<span class="var type1" id="S24T98U59">Im</span>]             =   <span class="fcn" id="F313N10:B61">I_I</span>(<span class="var type1" id="S4T4U62">R0</span>,<span class="var type1" id="S13T98U63">RL</span>,<span class="var type1" id="S12T94U64">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,30" id="srcline30">30</a></span><span class="line">    <span class="comment">%Mass Composite Body matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,31" id="srcline31">31</a></span><span class="line">    [<span class="var type1" id="S26T27U68">M0_tilde</span>,<span class="var type1" id="S27T101U69">Mm_tilde</span>] =   <span class="fcn" id="F314N15:B71">MCB</span>(<span class="var type1" id="S23T4U72">I0</span>,<span class="var type1" id="S24T98U73">Im</span>,<span class="var type1" id="S18T100U74">Bij</span>,<span class="var type1" id="S19T101U75">Bi0</span>,<span class="var type1" id="S12T94U76">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,32" id="srcline32">32</a></span><span class="line">    <span class="comment">%Generalized Inertia matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,33" id="srcline33">33</a></span><span class="line">    [<span class="var type1" id="S29T27U80">H0</span>,<span class="var type1" id="S30T29U81">H0m</span>,<span class="mxinfo " id="T30:U51">~</span>]         =   <span class="fcn" id="F328N7:B84">GIM</span>(<span class="var type1" id="S26T27U85">M0_tilde</span>,<span class="var type1" id="S27T101U86">Mm_tilde</span>,<span class="var type1" id="S18T100U87">Bij</span>,<span class="var type1" id="S19T101U88">Bi0</span>,<span class="var type1" id="S20T27U89">P0</span>,<span class="var type1" id="S21T33U90">pm</span>,<span class="var type1" id="S12T94U91">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,34" id="srcline34">34</a></span><span class="line">    <span class="comment">%u0=-inv(H0)*H0m*um +inv(H0)*moment_target_init;</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T27:U59"><span class="var type1" id="S2T27U94">u0</span> = <span class="mxinfo " id="T27:U61"><span class="mxinfo " id="T27:U62">-<span class="mxinfo " id="T27:U63">inv(<span class="var type1" id="S29T27U99">H0</span>)</span></span>*<span class="var type1" id="S8T5U100">moment_system</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T3:U66"><span class="var type1" id="S3T3U103">r_com</span> =<span class="mxinfo " id="T3:U68"><span class="fcn" id="F331N3:B105">Center_of_Mass</span>(<span class="var type1" id="S5T3U106">r0</span>,<span class="var type1" id="S14T99U107">rL</span>,<span class="var type1" id="S12T94U108">robot_sim</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,37" id="srcline37">37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,38" id="srcline38">38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,39" id="srcline39">39</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,40" id="srcline40">40</a></span><span class="line">    <span class="var type0" id="S12T0U112">robot_sim</span> = <span class="var type0" id="S10T0U113">robot_pre_sim</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,41" id="srcline41">41</a></span><span class="line">     <span class="comment">%--- Kinematics ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,42" id="srcline42">42</a></span><span class="line">    <span class="comment">%Kinematics</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,43" id="srcline43">43</a></span><span class="line">    [~,<span class="var type0" id="S13T0U118">RL</span>,~,<span class="var type0" id="S14T0U120">rL</span>,<span class="var type0" id="S15T0U121">e</span>,<span class="var type0" id="S16T0U122">g</span>]    =   Kinematics(<span class="var type0" id="S4T0U125">R0</span>,<span class="var type0" id="S5T0U126">r0</span>,<span class="var type0" id="S6T0U127">qm</span>,<span class="var type0" id="S12T0U128">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,44" id="srcline44">44</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="118,45" id="srcline45">45</a></span><span class="line">    <span class="comment">%Diferential Kinematics</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,46" id="srcline46">46</a></span><span class="line">    [<span class="var type0" id="S18T0U132">Bij</span>,<span class="var type0" id="S19T0U133">Bi0</span>,<span class="var type0" id="S20T0U134">P0</span>,<span class="var type0" id="S21T0U135">pm</span>]     =   DiffKinematics(<span class="var type0" id="S4T0U138">R0</span>,<span class="var type0" id="S5T0U139">r0</span>,<span class="var type0" id="S14T0U140">rL</span>,<span class="var type0" id="S15T0U141">e</span>,<span class="var type0" id="S16T0U142">g</span>,<span class="var type0" id="S12T0U143">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,47" id="srcline47">47</a></span><span class="line">    <span class="comment">%Velocities</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,48" id="srcline48">48</a></span><span class="line">    <span class="comment">%Inertias in inertial frames</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,49" id="srcline49">49</a></span><span class="line">    [<span class="var type0" id="S23T0U147">I0</span>,<span class="var type0" id="S24T0U148">Im</span>]             =   I_I(<span class="var type0" id="S4T0U151">R0</span>,<span class="var type0" id="S13T0U152">RL</span>,<span class="var type0" id="S12T0U153">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,50" id="srcline50">50</a></span><span class="line">    <span class="comment">%Mass Composite Body matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,51" id="srcline51">51</a></span><span class="line">    [<span class="var type0" id="S26T0U157">M0_tilde</span>,<span class="var type0" id="S27T0U158">Mm_tilde</span>] =   MCB(<span class="var type0" id="S23T0U161">I0</span>,<span class="var type0" id="S24T0U162">Im</span>,<span class="var type0" id="S18T0U163">Bij</span>,<span class="var type0" id="S19T0U164">Bi0</span>,<span class="var type0" id="S12T0U165">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,52" id="srcline52">52</a></span><span class="line">    <span class="comment">%Generalized Inertia matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,53" id="srcline53">53</a></span><span class="line">    [<span class="var type0" id="S29T0U169">H0</span>,<span class="var type0" id="S30T0U170">H0m</span>,~]         =   GIM(<span class="var type0" id="S26T0U174">M0_tilde</span>,<span class="var type0" id="S27T0U175">Mm_tilde</span>,<span class="var type0" id="S18T0U176">Bij</span>,<span class="var type0" id="S19T0U177">Bi0</span>,<span class="var type0" id="S20T0U178">P0</span>,<span class="var type0" id="S21T0U179">pm</span>,<span class="var type0" id="S12T0U180">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,54" id="srcline54">54</a></span><span class="line">    <span class="comment">%u0=-inv(H0)*H0m*um;</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,55" id="srcline55">55</a></span><span class="line">    <span class="var type0" id="S2T0U183">u0</span> = -inv(<span class="var type0" id="S29T0U188">H0</span>)*<span class="var type0" id="S8T0U189">moment_system</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,56" id="srcline56">56</a></span><span class="line">    <span class="var type0" id="S3T0U192">r_com</span> =Center_of_Mass(<span class="var type0" id="S5T0U195">r0</span>,<span class="var type0" id="S14T0U196">rL</span>,<span class="var type0" id="S12T0U197">robot_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="118,57" id="srcline57">57</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="118,58" id="srcline58">58</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="118,59" id="srcline59">59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,60" id="srcline60">60</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,61" id="srcline61">61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,62" id="srcline62">62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,63" id="srcline63">63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,64" id="srcline64">64</a></span><span class="line"></span></span>
</pre>
</body>
</html>
