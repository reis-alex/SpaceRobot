<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="44,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T27U3">H0</span>, <span class="var type1" id="S3T29U4">H0m</span>, <span class="var type1" id="S4T30U5">Hm</span>] = GIM(<span class="var type1" id="S5T27U8">M0_tilde</span>,<span class="var type1" id="S6T26U9">Mm_tilde</span>,<span class="var type1" id="S7T25U10">Bij</span>,<span class="var type1" id="S8T26U11">Bi0</span>,<span class="var type1" id="S9T27U12">P0</span>,<span class="var type1" id="S10T28U13">pm</span>,<span class="var type2" id="S11T6V1U14">robot</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="44,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Computes the Generalized Inertia Matrix (GIM) H of the multibody vehicle.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% This function uses a recursive algorithm.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% [H0, H0m, Hm] = GIM(M0_tilde,Mm_tilde,Bij,Bi0,P0,pm,robot)</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% :parameters: </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%   * M0_tilde -- Base-link mass composite body matrix -- as a [6x6] matrix .</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,10" id="srcline10">10</a></span><span class="line"><span class="comment">%   * Mm_tilde -- Manipulator mass composite body matrix -- as a [6x6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,11" id="srcline11">11</a></span><span class="line"><span class="comment">%   * Bij -- Twist-propagation matrix (for manipulator i&gt;0 and j&gt;0) -- as a [6x6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,12" id="srcline12">12</a></span><span class="line"><span class="comment">%   * Bi0 -- Twist-propagation matrix (for i&gt;0 and j=0) -- as a [6x6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,13" id="srcline13">13</a></span><span class="line"><span class="comment">%   * P0 -- Base-link twist-propagation "vector" -- as a [6x6] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,14" id="srcline14">14</a></span><span class="line"><span class="comment">%   * pm -- Manipulator twist-propagation "vector" -- as a [6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,15" id="srcline15">15</a></span><span class="line"><span class="comment">%   * robot -- Robot model (see :doc:`/Tutorial_Robot`).</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,16" id="srcline16">16</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,17" id="srcline17">17</a></span><span class="line"><span class="comment">% :return: </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,18" id="srcline18">18</a></span><span class="line"><span class="comment">%   * H0 -- Base-link inertia matrix -- as a [6x6] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,19" id="srcline19">19</a></span><span class="line"><span class="comment">%   * H0m -- Base-link -- manipulator coupling inertia matrix -- as a [6xn_q] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,20" id="srcline20">20</a></span><span class="line"><span class="comment">%   * Hm -- Manipulator inertia matrix -- as a [n_qxn_q] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,21" id="srcline21">21</a></span><span class="line"><span class="comment">%   </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,22" id="srcline22">22</a></span><span class="line"><span class="comment">% To obtain the full generalized inertia matrix H:</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,23" id="srcline23">23</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,24" id="srcline24">24</a></span><span class="line"><span class="comment">% .. code-block:: matlab</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,25" id="srcline25">25</a></span><span class="line"><span class="comment">%   </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,26" id="srcline26">26</a></span><span class="line"><span class="comment">%   %Compute H</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,27" id="srcline27">27</a></span><span class="line"><span class="comment">%   [H0, H0m, Hm] = GIM(M0_tilde,Mm_tilde,Bij,Bi0,P0,pm,robot);</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,28" id="srcline28">28</a></span><span class="line"><span class="comment">%   H=[H0,H0m;H0m';Hm];</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,29" id="srcline29">29</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,30" id="srcline30">30</a></span><span class="line"><span class="comment">% See also: :func:`src.kinematics_dynamics.CIM`.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,33" id="srcline33">33</a></span><span class="line"><span class="comment"><span class="comment">%{  </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="44,34" id="srcline34">34</a></span><span class="line"><span class="comment">    LICENSE</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,36" id="srcline36">36</a></span><span class="line"><span class="comment">    This program is free software: you can redistribute it and/or modify</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,37" id="srcline37">37</a></span><span class="line"><span class="comment">    it under the terms of the GNU Lesser General Public License as published by</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,38" id="srcline38">38</a></span><span class="line"><span class="comment">    the Free Software Foundation, either version 3 of the License, or</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,39" id="srcline39">39</a></span><span class="line"><span class="comment">    (at your option) any later version.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,41" id="srcline41">41</a></span><span class="line"><span class="comment">    This program is distributed in the hope that it will be useful,</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,42" id="srcline42">42</a></span><span class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,43" id="srcline43">43</a></span><span class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,44" id="srcline44">44</a></span><span class="line"><span class="comment">    GNU Lesser General Public License for more details.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,45" id="srcline45">45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,46" id="srcline46">46</a></span><span class="line"><span class="comment">    You should have received a copy of the GNU Lesser General Public License</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,47" id="srcline47">47</a></span><span class="line"><span class="comment">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,48" id="srcline48">48</a></span><span class="line"><span class="comment"><span class="comment">%}</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="44,49" id="srcline49">49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,50" id="srcline50">50</a></span><span class="line"><span class="comment">%=== CODE ===%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,52" id="srcline52">52</a></span><span class="line"><span class="comment">%--- Number of links and Joints ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo " id="T5:U11"><span class="var type1" id="S12T5U17">n_q</span>=<span class="mxinfo " id="T5:U13"><span class="var type1" id="S11T6U19">robot</span>.n_q</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,54" id="srcline54">54</a></span><span class="line"><span class="mxinfo " id="T5:U15"><span class="var type1" id="S13T5U23">n</span>=<span class="mxinfo " id="T5:U17"><span class="var type1" id="S11T6U25">robot</span>.n_links_joints</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,55" id="srcline55">55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,56" id="srcline56">56</a></span><span class="line"><span class="comment">%--- H matrix ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,57" id="srcline57">57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,58" id="srcline58">58</a></span><span class="line"><span class="comment">%Base-link inertia matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,59" id="srcline59">59</a></span><span class="line"><span class="mxinfo " id="T27:U19"><span class="var type1" id="S2T27U29">H0</span> = <span class="mxinfo " id="T27:U21"><span class="mxinfo " id="T27:U22"><span class="mxinfo " id="T27:U23"><span class="var type1" id="S9T27U33">P0</span>'</span>*<span class="var type1" id="S5T27U34">M0_tilde</span></span>*<span class="var type1" id="S9T27U35">P0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,60" id="srcline60">60</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,61" id="srcline61">61</a></span><span class="line"><span class="comment">%Pre-allocate Hm</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,62" id="srcline62">62</a></span><span class="line"><span class="mxinfo " id="T30:U27"><span class="var type1" id="S4T30U38">Hm</span>=<span class="mxinfo " id="T30:U29">zeros(<span class="var type1" id="S12T5U41">n_q</span>,<span class="var type1" id="S12T5U42">n_q</span>,<span class="string">'like'</span>,<span class="var type1" id="S5T27U44">M0_tilde</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,63" id="srcline63">63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,64" id="srcline64">64</a></span><span class="line"><span class="comment">%Manipulator inertia matrix Hm</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,65" id="srcline65">65</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S15T5U47">j</span>=<span class="mxinfo " id="T16:U34"><span class="mxinfo " id="T5:U35">1</span>:<span class="var type1" id="S13T5U50">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="44,66" id="srcline66">66</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S16T5U53">i</span>=<span class="mxinfo " id="T65:U38"><span class="var type1" id="S15T5U55">j</span>:<span class="var type1" id="S13T5U56">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="44,67" id="srcline67">67</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T44:U41"><span class="mxinfo " id="T5:U42"><span class="mxinfo " id="T43:U43"><span class="mxinfo " id="T7:U44"><span class="var type1" id="S11T6U64">robot</span>.joints</span>(<span class="var type1" id="S16T5U66">i</span>)</span>.type</span>~=<span class="mxinfo " id="T5:U47">0</span></span> &amp;&amp; <span class="mxinfo " id="T44:U48"><span class="mxinfo " id="T5:U49"><span class="mxinfo " id="T43:U50"><span class="mxinfo " id="T7:U51"><span class="var type1" id="S11T6U73">robot</span>.joints</span>(<span class="var type1" id="S15T5U75">j</span>)</span>.type</span>~=<span class="mxinfo " id="T5:U54">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="44,68" id="srcline68">68</a></span><span class="line">            <span class="mxinfo " id="T5:U55"><span class="mxinfo " id="T5:U56"><span class="var type1" id="S4T30U81">Hm</span>(<span class="mxinfo " id="T5:U58"><span class="mxinfo " id="T43:U59"><span class="mxinfo " id="T7:U60"><span class="var type1" id="S11T6U85">robot</span>.joints</span>(<span class="var type1" id="S16T5U87">i</span>)</span>.q_id</span>,<span class="mxinfo " id="T5:U63"><span class="mxinfo " id="T43:U64"><span class="mxinfo " id="T7:U65"><span class="var type1" id="S11T6U92">robot</span>.joints</span>(<span class="var type1" id="S15T5U94">j</span>)</span>.q_id</span>)</span>=<span class="mxinfo " id="T5:U68"><span class="mxinfo " id="T62:U69"><span class="mxinfo " id="T62:U70"><span class="mxinfo " id="T62:U71"><span class="mxinfo " id="T2:U72"><span class="var type1" id="S10T28U101">pm</span>(<span class="mxinfo " id="T35:U74">1:6</span>,<span class="var type1" id="S16T5U105">i</span>)</span>'</span>*<span class="mxinfo " id="T27:U76"><span class="var type1" id="S6T26U107">Mm_tilde</span>(<span class="mxinfo " id="T35:U78">1:6</span>,<span class="mxinfo " id="T35:U79">1:6</span>,<span class="var type1" id="S16T5U114">i</span>)</span></span>*<span class="mxinfo " id="T27:U81"><span class="var type1" id="S7T25U116">Bij</span>(<span class="mxinfo " id="T35:U83">1:6</span>,<span class="mxinfo " id="T35:U84">1:6</span>,<span class="var type1" id="S16T5U123">i</span>,<span class="var type1" id="S15T5U124">j</span>)</span></span>*<span class="mxinfo " id="T2:U87"><span class="var type1" id="S10T28U126">pm</span>(<span class="mxinfo " id="T35:U89">1:6</span>,<span class="var type1" id="S15T5U130">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,69" id="srcline69">69</a></span><span class="line">            <span class="mxinfo " id="T5:U91"><span class="mxinfo " id="T5:U92"><span class="var type1" id="S4T30U134">Hm</span>(<span class="mxinfo " id="T5:U94"><span class="mxinfo " id="T43:U95"><span class="mxinfo " id="T7:U96"><span class="var type1" id="S11T6U138">robot</span>.joints</span>(<span class="var type1" id="S15T5U140">j</span>)</span>.q_id</span>,<span class="mxinfo " id="T5:U99"><span class="mxinfo " id="T43:U100"><span class="mxinfo " id="T7:U101"><span class="var type1" id="S11T6U145">robot</span>.joints</span>(<span class="var type1" id="S16T5U147">i</span>)</span>.q_id</span>)</span>=<span class="mxinfo " id="T5:U104"><span class="var type1" id="S4T30U150">Hm</span>(<span class="mxinfo " id="T5:U106"><span class="mxinfo " id="T43:U107"><span class="mxinfo " id="T7:U108"><span class="var type1" id="S11T6U154">robot</span>.joints</span>(<span class="var type1" id="S16T5U156">i</span>)</span>.q_id</span>,<span class="mxinfo " id="T5:U111"><span class="mxinfo " id="T43:U112"><span class="mxinfo " id="T7:U113"><span class="var type1" id="S11T6U161">robot</span>.joints</span>(<span class="var type1" id="S15T5U163">j</span>)</span>.q_id</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,70" id="srcline70">70</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,71" id="srcline71">71</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,72" id="srcline72">72</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,73" id="srcline73">73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,74" id="srcline74">74</a></span><span class="line"><span class="comment">%Pre-allocate H0m</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,75" id="srcline75">75</a></span><span class="line"><span class="mxinfo " id="T29:U116"><span class="var type1" id="S3T29U167">H0m</span>=<span class="mxinfo " id="T29:U118">zeros(<span class="mxinfo " id="T5:U119">6</span>,<span class="var type1" id="S12T5U171">n_q</span>,<span class="string">'like'</span>,<span class="var type1" id="S5T27U173">M0_tilde</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="44,76" id="srcline76">76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,77" id="srcline77">77</a></span><span class="line"><span class="comment">%Coupling inertia matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,78" id="srcline78">78</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S16T5U176">i</span>=<span class="mxinfo " id="T16:U123"><span class="mxinfo " id="T5:U124">1</span>:<span class="var type1" id="S13T5U179">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="44,79" id="srcline79">79</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T44:U126"><span class="mxinfo " id="T5:U127"><span class="mxinfo " id="T43:U128"><span class="mxinfo " id="T7:U129"><span class="var type1" id="S11T6U186">robot</span>.joints</span>(<span class="var type1" id="S16T5U188">i</span>)</span>.type</span>~=<span class="mxinfo " id="T5:U132">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="44,80" id="srcline80">80</a></span><span class="line">        <span class="mxinfo " id="T2:U133"><span class="mxinfo " id="T2:U134"><span class="var type1" id="S3T29U194">H0m</span>(<span class="mxinfo " id="T62:U136"><span class="mxinfo " id="T5:U137">1</span>:<span class="mxinfo " id="T5:U138">6</span></span>,<span class="mxinfo " id="T5:U139"><span class="mxinfo " id="T43:U140"><span class="mxinfo " id="T7:U141"><span class="var type1" id="S11T6U201">robot</span>.joints</span>(<span class="var type1" id="S16T5U203">i</span>)</span>.q_id</span>)</span>=<span class="mxinfo " id="T2:U144">(<span class="mxinfo " id="T62:U145"><span class="mxinfo " id="T62:U146"><span class="mxinfo " id="T62:U147"><span class="mxinfo " id="T62:U148"><span class="mxinfo " id="T2:U149"><span class="var type1" id="S10T28U212">pm</span>(<span class="mxinfo " id="T35:U151">1:6</span>,<span class="var type1" id="S16T5U216">i</span>)</span>'</span>*<span class="mxinfo " id="T27:U153"><span class="var type1" id="S6T26U218">Mm_tilde</span>(<span class="mxinfo " id="T35:U155">1:6</span>,<span class="mxinfo " id="T35:U156">1:6</span>,<span class="var type1" id="S16T5U225">i</span>)</span></span>*<span class="mxinfo " id="T27:U158"><span class="var type1" id="S8T26U227">Bi0</span>(<span class="mxinfo " id="T35:U160">1:6</span>,<span class="mxinfo " id="T35:U161">1:6</span>,<span class="var type1" id="S16T5U234">i</span>)</span></span>*<span class="var type1" id="S9T27U235">P0</span></span>)'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,81" id="srcline81">81</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,82" id="srcline82">82</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,83" id="srcline83">83</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,84" id="srcline84">84</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
