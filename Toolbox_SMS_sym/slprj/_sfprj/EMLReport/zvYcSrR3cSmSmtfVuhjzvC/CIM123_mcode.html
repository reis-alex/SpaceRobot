<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="45,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T27U3">C0</span>, <span class="var type1" id="S3T29U4">C0m</span>, <span class="var type1" id="S4T31U5">Cm0</span>, <span class="var type1" id="S5T30U6">Cm</span>] = CIM(<span class="var type1" id="S6T2U9">t0</span>,<span class="var type1" id="S7T28U10">tL</span>,<span class="var type1" id="S8T4U11">I0</span>,<span class="var type1" id="S9T23U12">Im</span>,<span class="var type1" id="S10T27U13">M0_tilde</span>,<span class="var type1" id="S11T26U14">Mm_tilde</span>,<span class="var type1" id="S12T25U15">Bij</span>,<span class="var type1" id="S13T26U16">Bi0</span>,<span class="var type1" id="S14T27U17">P0</span>,<span class="var type1" id="S15T28U18">pm</span>,<span class="var type2" id="S16T19V2U19">robot</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="45,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% Computes the Generalized Convective Inertia Matrix C of the multibody system.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% :parameters: </span></span></span>
<span class="srcline"><span class="lineno"><a href="45,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   * t0 -- Base-link twist [\omega,rdot], projected in the inertial CCS -- as a [6x1] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   * tL -- Manipulator twist [\omega,rdot], projected in the inertial CCS -- as a [6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   * I0 -- Base-link inertia matrix, projected in the inertial CCS -- as a [3x3] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   * Im -- Links inertia matrices, projected in the inertial CCS -- as a [3x3xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   * M0_tilde -- Base-link mass composite body matrix -- as a [6x6] matrix .</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   * Mm_tilde -- Manipulator mass composite body matrix -- as a [6x6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   * Bij -- Twist-propagation matrix (for manipulator i&gt;0 and j&gt;0) -- as a [6x6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%   * Bi0 -- Twist-propagation matrix (for i&gt;0 and j=0) -- as a [6x6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%   * P0 -- Base-link twist-propagation "vector" -- as a [6x6] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%   * pm -- Manipulator twist-propagation "vector" -- as a [6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%   * robot -- Robot model (see :doc:`/Tutorial_Robot`).</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% :return: </span></span></span>
<span class="srcline"><span class="lineno"><a href="45,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%   * C0 -&gt; Base-link convective inertia matrix -- as a [6x6] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%   * C0m -&gt; Base-link - manipulator coupling convective inertia matrix -- as a [6xn_q] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%   * Cm0 -&gt; Manipulator - base-link coupling convective inertia matrix -- as a [n_qx6] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%   * Cm -&gt; Manipulator convective inertia matrix -- as a [n_qxn_q] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% To obtain the full convective inertia matrix C:</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">% .. code-block:: matlab</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%   </span></span></span>
<span class="srcline"><span class="lineno"><a href="45,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%   %Compute the Convective Inertia Matrix C</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%   [C0, C0m, Cm0, Cm] = CIM(t0,tL,I0,Im,M0_tilde,Mm_tilde,Bij,Bi0,P0,pm,robot)</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%   C=[C0,C0m;Cm0,Cm];</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">% See also: :func:`src.kinematics_dynamics.GIM`.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,33" id="srcline33"> 33</a></span><span class="line"><span class="comment"><span class="comment">%{  </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">    LICENSE</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">    This program is free software: you can redistribute it and/or modify</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">    it under the terms of the GNU Lesser General Public License as published by</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">    the Free Software Foundation, either version 3 of the License, or</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">    (at your option) any later version.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,40" id="srcline40"> 40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">    This program is distributed in the hope that it will be useful,</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">    GNU Lesser General Public License for more details.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,45" id="srcline45"> 45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">    You should have received a copy of the GNU Lesser General Public License</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,48" id="srcline48"> 48</a></span><span class="line"><span class="comment"><span class="comment">%}</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%=== CODE ===%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,51" id="srcline51"> 51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%--- Number of links and Joints ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo " id="T5:U16"><span class="var type1" id="S17T5U22">n_q</span>=<span class="mxinfo " id="T5:U18"><span class="var type1" id="S16T19U24">robot</span>.n_q</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo " id="T5:U20"><span class="var type1" id="S18T5U28">n</span>=<span class="mxinfo " id="T5:U22"><span class="var type1" id="S16T19U30">robot</span>.n_links_joints</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%--- Omega ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%Base-link Omega</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo " id="T27:U24"><span class="var type1" id="S19T27U34">Omega0</span>=<span class="mxinfo " id="T27:U26">[<span class="mxinfo " id="T63:U27"><span class="mxinfo " id="T4:U28"><span class="fcn" id="F58N18:B38">SkewSym</span>(<span class="mxinfo " id="T3:U29"><span class="var type1" id="S6T2U40">t0</span>(<span class="mxinfo " id="T71:U31">1:3</span>)</span>)</span>, <span class="mxinfo " id="T4:U32">zeros(<span class="mxinfo " id="T5:U33">3</span>,<span class="mxinfo " id="T5:U34">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,59" id="srcline59"> 59</a></span><span class="line">    <span class="mxinfo " id="T63:U35">zeros(<span class="mxinfo " id="T5:U36">3</span>,<span class="mxinfo " id="T5:U37">3</span>), zeros(<span class="mxinfo " id="T5:U38">3</span>,<span class="mxinfo " id="T5:U39">3</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,60" id="srcline60"> 60</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%Pre-allocate Omega</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo " id="T26:U40"><span class="var type1" id="S22T26U59">Omega</span>=<span class="mxinfo " id="T26:U42">zeros(<span class="mxinfo " id="T5:U43">6</span>,<span class="mxinfo " id="T5:U44">6</span>,<span class="var type1" id="S18T5U64">n</span>,<span class="string">'like'</span>,<span class="var type1" id="S6T2U66">t0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,63" id="srcline63"> 63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%Compute Omega</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,65" id="srcline65"> 65</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T5U69">i</span>=<span class="mxinfo " id="T16:U48"><span class="mxinfo " id="T5:U49">1</span>:<span class="var type1" id="S18T5U72">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,66" id="srcline66"> 66</a></span><span class="line">    <span class="mxinfo " id="T27:U51"><span class="mxinfo " id="T27:U52"><span class="var type1" id="S22T26U76">Omega</span>(<span class="mxinfo " id="T62:U54"><span class="mxinfo " id="T5:U55">1</span>:<span class="mxinfo " id="T5:U56">6</span></span>,<span class="mxinfo " id="T62:U57"><span class="mxinfo " id="T5:U58">1</span>:<span class="mxinfo " id="T5:U59">6</span></span>,<span class="var type1" id="S23T5U83">i</span>)</span>=<span class="mxinfo " id="T27:U61">[<span class="mxinfo " id="T63:U62"><span class="mxinfo " id="T4:U63"><span class="fcn" id="F58N18:B87">SkewSym</span>(<span class="mxinfo " id="T3:U64"><span class="var type1" id="S7T28U89">tL</span>(<span class="mxinfo " id="T36:U66">1:3</span>,<span class="var type1" id="S23T5U93">i</span>)</span>)</span>, <span class="mxinfo " id="T4:U68">zeros(<span class="mxinfo " id="T5:U69">3</span>,<span class="mxinfo " id="T5:U70">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,67" id="srcline67"> 67</a></span><span class="line">        <span class="mxinfo " id="T63:U71"><span class="mxinfo " id="T4:U72">zeros(<span class="mxinfo " id="T5:U73">3</span>,<span class="mxinfo " id="T5:U74">3</span>)</span>, <span class="mxinfo " id="T4:U75"><span class="fcn" id="F58N18:B104">SkewSym</span>(<span class="mxinfo " id="T3:U76"><span class="var type1" id="S7T28U106">tL</span>(<span class="mxinfo " id="T36:U78">1:3</span>,<span class="var type1" id="S23T5U110">i</span>)</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,68" id="srcline68"> 68</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%--- Mdot ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%Base-link Mdot</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,72" id="srcline72"> 72</a></span><span class="line"><span class="mxinfo " id="T27:U80"><span class="var type1" id="S24T27U113">Mdot0</span>=<span class="mxinfo " id="T27:U82">[<span class="mxinfo " id="T63:U83"><span class="mxinfo " id="T4:U84"><span class="mxinfo " id="T4:U85"><span class="var type1" id="S19T27U118">Omega0</span>(<span class="mxinfo " id="T36:U87">1:3</span>,<span class="mxinfo " id="T36:U88">1:3</span>)</span>*<span class="var type1" id="S8T4U125">I0</span></span>, <span class="mxinfo " id="T4:U90">zeros(<span class="mxinfo " id="T5:U91">3</span>,<span class="mxinfo " id="T5:U92">3</span>)</span></span>; <span class="mxinfo " id="T63:U93"><span class="mxinfo " id="T4:U94">zeros(<span class="mxinfo " id="T5:U95">3</span>,<span class="mxinfo " id="T5:U96">3</span>)</span>, <span class="mxinfo " id="T4:U97">zeros(<span class="mxinfo " id="T5:U98">3</span>,<span class="mxinfo " id="T5:U99">3</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%Pre-allocate</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,75" id="srcline75"> 75</a></span><span class="line"><span class="mxinfo " id="T26:U100"><span class="var type1" id="S25T26U141">Mdot</span>=<span class="mxinfo " id="T26:U102">zeros(<span class="mxinfo " id="T5:U103">6</span>,<span class="mxinfo " id="T5:U104">6</span>,<span class="var type1" id="S18T5U146">n</span>,<span class="string">'like'</span>,<span class="var type1" id="S6T2U148">t0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,76" id="srcline76"> 76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%Compute Mdot</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,78" id="srcline78"> 78</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T5U151">i</span>=<span class="mxinfo " id="T16:U108"><span class="mxinfo " id="T5:U109">1</span>:<span class="var type1" id="S18T5U154">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,79" id="srcline79"> 79</a></span><span class="line">    <span class="mxinfo " id="T27:U111"><span class="mxinfo " id="T27:U112"><span class="var type1" id="S25T26U158">Mdot</span>(<span class="mxinfo " id="T62:U114"><span class="mxinfo " id="T5:U115">1</span>:<span class="mxinfo " id="T5:U116">6</span></span>,<span class="mxinfo " id="T62:U117"><span class="mxinfo " id="T5:U118">1</span>:<span class="mxinfo " id="T5:U119">6</span></span>,<span class="var type1" id="S23T5U165">i</span>)</span>=<span class="mxinfo " id="T27:U121">[<span class="mxinfo " id="T63:U122"><span class="mxinfo " id="T4:U123"><span class="mxinfo " id="T4:U124"><span class="var type1" id="S22T26U170">Omega</span>(<span class="mxinfo " id="T36:U126">1:3</span>,<span class="mxinfo " id="T36:U127">1:3</span>,<span class="var type1" id="S23T5U177">i</span>)</span>*<span class="mxinfo " id="T4:U129"><span class="var type1" id="S9T23U179">Im</span>(<span class="mxinfo " id="T36:U131">1:3</span>,<span class="mxinfo " id="T36:U132">1:3</span>,<span class="var type1" id="S23T5U186">i</span>)</span></span>, <span class="mxinfo " id="T4:U134">zeros(<span class="mxinfo " id="T5:U135">3</span>,<span class="mxinfo " id="T5:U136">3</span>)</span></span>; <span class="mxinfo " id="T63:U137"><span class="mxinfo " id="T4:U138">zeros(<span class="mxinfo " id="T5:U139">3</span>,<span class="mxinfo " id="T5:U140">3</span>)</span>, <span class="mxinfo " id="T4:U141">zeros(<span class="mxinfo " id="T5:U142">3</span>,<span class="mxinfo " id="T5:U143">3</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,80" id="srcline80"> 80</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,81" id="srcline81"> 81</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%--- Mdot tilde ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%Pre-Allocate</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,84" id="srcline84"> 84</a></span><span class="line"><span class="mxinfo " id="T26:U144"><span class="var type1" id="S26T26U202">Mdot_tilde</span>=<span class="mxinfo " id="T26:U146">zeros(<span class="mxinfo " id="T5:U147">6</span>,<span class="mxinfo " id="T5:U148">6</span>,<span class="var type1" id="S18T5U207">n</span>,<span class="string">'like'</span>,<span class="var type1" id="S6T2U209">t0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,85" id="srcline85"> 85</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%Backwards recursion</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,87" id="srcline87"> 87</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T5U212">i</span>=<span class="mxinfo " id="T16:U152"><span class="var type1" id="S18T5U215">n</span>:<span class="mxinfo " id="T5:U154">-1</span>:1</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,88" id="srcline88"> 88</a></span><span class="line">    <span class="comment">%Initialize</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,89" id="srcline89"> 89</a></span><span class="line">    <span class="mxinfo " id="T27:U155"><span class="mxinfo " id="T27:U156"><span class="var type1" id="S26T26U222">Mdot_tilde</span>(<span class="mxinfo " id="T62:U158"><span class="mxinfo " id="T5:U159">1</span>:<span class="mxinfo " id="T5:U160">6</span></span>,<span class="mxinfo " id="T62:U161"><span class="mxinfo " id="T5:U162">1</span>:<span class="mxinfo " id="T5:U163">6</span></span>,<span class="var type1" id="S23T5U229">i</span>)</span>=<span class="mxinfo " id="T27:U165"><span class="var type1" id="S25T26U231">Mdot</span>(<span class="mxinfo " id="T62:U167"><span class="mxinfo " id="T5:U168">1</span>:<span class="mxinfo " id="T5:U169">6</span></span>,<span class="mxinfo " id="T62:U170"><span class="mxinfo " id="T5:U171">1</span>:<span class="mxinfo " id="T5:U172">6</span></span>,<span class="var type1" id="S23T5U238">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,90" id="srcline90"> 90</a></span><span class="line">    <span class="comment">%Add children contributions</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,91" id="srcline91"> 91</a></span><span class="line">    <span class="mxinfo " id="T64:U174"><span class="var type1" id="S27T64U241">child</span>=<span class="mxinfo " id="T64:U176"><span class="mxinfo " id="T65:U177">find(<span class="mxinfo " id="T16:U178"><span class="mxinfo " id="T15:U179"><span class="mxinfo " id="T14:U180"><span class="var type1" id="S16T19U248">robot</span>.con</span>.child</span>(<span class="mxinfo " id="T66:U182">:</span>,<span class="var type1" id="S23T5U252">i</span>)</span>)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,92" id="srcline92"> 92</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S29T5U255">j</span>=<span class="mxinfo " id="T65:U185"><span class="mxinfo " id="T5:U186">1</span>:<span class="mxinfo " id="T5:U187">length(<span class="var type1" id="S27T64U260">child</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,93" id="srcline93"> 93</a></span><span class="line">        <span class="mxinfo " id="T27:U189"><span class="mxinfo " id="T27:U190"><span class="var type1" id="S26T26U264">Mdot_tilde</span>(<span class="mxinfo " id="T62:U192"><span class="mxinfo " id="T5:U193">1</span>:<span class="mxinfo " id="T5:U194">6</span></span>,<span class="mxinfo " id="T62:U195"><span class="mxinfo " id="T5:U196">1</span>:<span class="mxinfo " id="T5:U197">6</span></span>,<span class="var type1" id="S23T5U271">i</span>)</span>=<span class="mxinfo " id="T27:U199"><span class="mxinfo " id="T27:U200"><span class="var type1" id="S26T26U274">Mdot_tilde</span>(<span class="mxinfo " id="T62:U202"><span class="mxinfo " id="T5:U203">1</span>:<span class="mxinfo " id="T5:U204">6</span></span>,<span class="mxinfo " id="T62:U205"><span class="mxinfo " id="T5:U206">1</span>:<span class="mxinfo " id="T5:U207">6</span></span>,<span class="var type1" id="S23T5U281">i</span>)</span>+<span class="mxinfo " id="T27:U209"><span class="var type1" id="S26T26U283">Mdot_tilde</span>(<span class="mxinfo " id="T62:U211"><span class="mxinfo " id="T5:U212">1</span>:<span class="mxinfo " id="T5:U213">6</span></span>,<span class="mxinfo " id="T62:U214"><span class="mxinfo " id="T5:U215">1</span>:<span class="mxinfo " id="T5:U216">6</span></span>,<span class="mxinfo " id="T5:U217"><span class="var type1" id="S27T64U291">child</span>(<span class="var type1" id="S29T5U292">j</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,94" id="srcline94"> 94</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,95" id="srcline95"> 95</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">%Base-link</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo " id="T27:U220"><span class="var type1" id="S31T27U295">Mdot0_tilde</span> = <span class="var type1" id="S24T27U296">Mdot0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%Add children contributions</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,99" id="srcline99"> 99</a></span><span class="line"><span class="mxinfo " id="T64:U223"><span class="var type1" id="S27T64U299">child</span>=<span class="mxinfo " id="T64:U225"><span class="mxinfo " id="T65:U226">find(<span class="var type1" id="S16T19U305">robot</span>.con.child_base)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,100" id="srcline100">100</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T5U310">j</span>=<span class="mxinfo " id="T65:U229"><span class="mxinfo " id="T5:U230">1</span>:<span class="mxinfo " id="T5:U231">length(<span class="var type1" id="S27T64U315">child</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,101" id="srcline101">101</a></span><span class="line">    <span class="mxinfo " id="T27:U233"><span class="var type1" id="S31T27U318">Mdot0_tilde</span> = <span class="mxinfo " id="T27:U235"><span class="var type1" id="S31T27U320">Mdot0_tilde</span>+<span class="mxinfo " id="T27:U237"><span class="var type1" id="S26T26U322">Mdot_tilde</span>(<span class="mxinfo " id="T62:U239"><span class="mxinfo " id="T5:U240">1</span>:<span class="mxinfo " id="T5:U241">6</span></span>,<span class="mxinfo " id="T62:U242"><span class="mxinfo " id="T5:U243">1</span>:<span class="mxinfo " id="T5:U244">6</span></span>,<span class="mxinfo " id="T5:U245"><span class="var type1" id="S27T64U330">child</span>(<span class="var type1" id="S29T5U331">j</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,102" id="srcline102">102</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,104" id="srcline104">104</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,105" id="srcline105">105</a></span><span class="line"><span class="comment">%--- Bdot ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,107" id="srcline107">107</a></span><span class="line"><span class="comment">%Pre-allocate Bdotij</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo " id="T25:U248"><span class="var type1" id="S32T25U334">Bdotij</span>=<span class="mxinfo " id="T25:U250">zeros(<span class="mxinfo " id="T5:U251">6</span>,<span class="mxinfo " id="T5:U252">6</span>,<span class="var type1" id="S18T5U339">n</span>,<span class="var type1" id="S18T5U340">n</span>,<span class="string">'like'</span>,<span class="var type1" id="S6T2U342">t0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,110" id="srcline110">110</a></span><span class="line"><span class="comment">%Compute Bdotij</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,111" id="srcline111">111</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T5U345">j</span>=<span class="mxinfo " id="T16:U257"><span class="mxinfo " id="T5:U258">1</span>:<span class="var type1" id="S18T5U348">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,112" id="srcline112">112</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S23T5U351">i</span>=<span class="mxinfo " id="T16:U261"><span class="mxinfo " id="T5:U262">1</span>:<span class="var type1" id="S18T5U354">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,113" id="srcline113">113</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T44:U264"><span class="mxinfo " id="T5:U265"><span class="mxinfo " id="T15:U266"><span class="mxinfo " id="T14:U267"><span class="var type1" id="S16T19U361">robot</span>.con</span>.branch</span>(<span class="var type1" id="S23T5U364">i</span>,<span class="var type1" id="S29T5U365">j</span>)</span>==<span class="mxinfo " id="T5:U271">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,114" id="srcline114">114</a></span><span class="line">            <span class="comment">%Links are in the same branch</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,115" id="srcline115">115</a></span><span class="line">            <span class="mxinfo " id="T27:U272"><span class="mxinfo " id="T27:U273"><span class="var type1" id="S32T25U370">Bdotij</span>(<span class="mxinfo " id="T62:U275"><span class="mxinfo " id="T5:U276">1</span>:<span class="mxinfo " id="T5:U277">6</span></span>,<span class="mxinfo " id="T62:U278"><span class="mxinfo " id="T5:U279">1</span>:<span class="mxinfo " id="T5:U280">6</span></span>,<span class="var type1" id="S23T5U377">i</span>,<span class="var type1" id="S29T5U378">j</span>)</span>=<span class="mxinfo " id="T27:U283">[<span class="mxinfo " id="T63:U284"><span class="mxinfo " id="T4:U285">zeros(<span class="mxinfo " id="T5:U286">3</span>,<span class="mxinfo " id="T5:U287">3</span>)</span>, <span class="mxinfo " id="T4:U288">zeros(<span class="mxinfo " id="T5:U289">3</span>,<span class="mxinfo " id="T5:U290">3</span>)</span></span>; <span class="mxinfo " id="T63:U291"><span class="mxinfo " id="T4:U292"><span class="fcn" id="F58N18:B391">SkewSym</span>(<span class="mxinfo " id="T3:U293"><span class="mxinfo " id="T3:U294"><span class="var type1" id="S7T28U394">tL</span>(<span class="mxinfo " id="T36:U296">4:6</span>,<span class="var type1" id="S29T5U398">j</span>)</span>-<span class="mxinfo " id="T3:U298"><span class="var type1" id="S7T28U400">tL</span>(<span class="mxinfo " id="T46:U300"><span class="mxinfo " id="T5:U301">4</span>:<span class="mxinfo " id="T5:U302">6</span></span>,<span class="var type1" id="S23T5U404">i</span>)</span></span>)</span>, <span class="mxinfo " id="T4:U304">zeros(<span class="mxinfo " id="T5:U305">3</span>,<span class="mxinfo " id="T5:U306">3</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,116" id="srcline116">116</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,117" id="srcline117">117</a></span><span class="line">            <span class="comment">%Links are not in the same branch</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,118" id="srcline118">118</a></span><span class="line">            <span class="mxinfo " id="T27:U307"><span class="mxinfo " id="T27:U308"><span class="var type1" id="S32T25U413">Bdotij</span>(<span class="mxinfo " id="T62:U310"><span class="mxinfo " id="T5:U311">1</span>:<span class="mxinfo " id="T5:U312">6</span></span>,<span class="mxinfo " id="T62:U313"><span class="mxinfo " id="T5:U314">1</span>:<span class="mxinfo " id="T5:U315">6</span></span>,<span class="var type1" id="S23T5U420">i</span>,<span class="var type1" id="S29T5U421">j</span>)</span>=<span class="mxinfo " id="T27:U318">zeros(<span class="mxinfo " id="T5:U319">6</span>,<span class="mxinfo " id="T5:U320">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,119" id="srcline119">119</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,120" id="srcline120">120</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,121" id="srcline121">121</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,122" id="srcline122">122</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,123" id="srcline123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,124" id="srcline124">124</a></span><span class="line"><span class="comment">%--- Hij tilde ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,125" id="srcline125">125</a></span><span class="line"><span class="comment">%Pre-allocate Hij_tilde</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo " id="T25:U321"><span class="var type1" id="S33T25U428">Hij_tilde</span>=<span class="mxinfo " id="T25:U323">zeros(<span class="mxinfo " id="T5:U324">6</span>,<span class="mxinfo " id="T5:U325">6</span>,<span class="var type1" id="S18T5U433">n</span>,<span class="var type1" id="S18T5U434">n</span>,<span class="string">'like'</span>,<span class="var type1" id="S6T2U436">t0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,127" id="srcline127">127</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,128" id="srcline128">128</a></span><span class="line"><span class="comment">%Hij_tilde</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,129" id="srcline129">129</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T5U439">i</span>=<span class="mxinfo " id="T16:U330"><span class="var type1" id="S18T5U442">n</span>:<span class="mxinfo " id="T5:U332">-1</span>:1</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,130" id="srcline130">130</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S29T5U448">j</span>=<span class="mxinfo " id="T16:U334"><span class="var type1" id="S18T5U451">n</span>:<span class="mxinfo " id="T5:U336">-1</span>:1</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,131" id="srcline131">131</a></span><span class="line">        <span class="mxinfo " id="T27:U337"><span class="mxinfo " id="T27:U338"><span class="var type1" id="S33T25U458">Hij_tilde</span>(<span class="mxinfo " id="T62:U340"><span class="mxinfo " id="T5:U341">1</span>:<span class="mxinfo " id="T5:U342">6</span></span>,<span class="mxinfo " id="T62:U343"><span class="mxinfo " id="T5:U344">1</span>:<span class="mxinfo " id="T5:U345">6</span></span>,<span class="var type1" id="S23T5U465">i</span>,<span class="var type1" id="S29T5U466">j</span>)</span>=<span class="mxinfo " id="T27:U348"><span class="mxinfo " id="T27:U349"><span class="var type1" id="S11T26U469">Mm_tilde</span>(<span class="mxinfo " id="T35:U351">1:6</span>,<span class="mxinfo " id="T35:U352">1:6</span>,<span class="var type1" id="S23T5U476">i</span>)</span>*<span class="mxinfo " id="T27:U354"><span class="var type1" id="S32T25U478">Bdotij</span>(<span class="mxinfo " id="T35:U356">1:6</span>,<span class="mxinfo " id="T35:U357">1:6</span>,<span class="var type1" id="S23T5U485">i</span>,<span class="var type1" id="S29T5U486">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,132" id="srcline132">132</a></span><span class="line">        <span class="comment">%Add children contributions</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,133" id="srcline133">133</a></span><span class="line">        <span class="mxinfo " id="T64:U360"><span class="var type1" id="S27T64U489">child</span>=<span class="mxinfo " id="T64:U362"><span class="mxinfo " id="T65:U363">find(<span class="mxinfo " id="T16:U364"><span class="mxinfo " id="T15:U365"><span class="mxinfo " id="T14:U366"><span class="var type1" id="S16T19U496">robot</span>.con</span>.child</span>(<span class="mxinfo " id="T66:U368">:</span>,<span class="var type1" id="S23T5U500">i</span>)</span>)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,134" id="srcline134">134</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S34T5U503">k</span>=<span class="mxinfo " id="T65:U371"><span class="mxinfo " id="T5:U372">1</span>:<span class="mxinfo " id="T5:U373">length(<span class="var type1" id="S27T64U508">child</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,135" id="srcline135">135</a></span><span class="line">            <span class="mxinfo " id="T27:U375"><span class="mxinfo " id="T27:U376"><span class="var type1" id="S33T25U512">Hij_tilde</span>(<span class="mxinfo " id="T62:U378"><span class="mxinfo " id="T5:U379">1</span>:<span class="mxinfo " id="T5:U380">6</span></span>,<span class="mxinfo " id="T62:U381"><span class="mxinfo " id="T5:U382">1</span>:<span class="mxinfo " id="T5:U383">6</span></span>,<span class="var type1" id="S23T5U519">i</span>,<span class="var type1" id="S29T5U520">j</span>)</span>=<span class="mxinfo " id="T27:U386"><span class="mxinfo " id="T27:U387"><span class="var type1" id="S33T25U523">Hij_tilde</span>(<span class="mxinfo " id="T62:U389"><span class="mxinfo " id="T5:U390">1</span>:<span class="mxinfo " id="T5:U391">6</span></span>,<span class="mxinfo " id="T62:U392"><span class="mxinfo " id="T5:U393">1</span>:<span class="mxinfo " id="T5:U394">6</span></span>,<span class="var type1" id="S23T5U530">i</span>,<span class="var type1" id="S29T5U531">j</span>)</span>+<span class="mxinfo " id="T27:U397"><span class="mxinfo " id="T27:U398"><span class="mxinfo " id="T27:U399"><span class="var type1" id="S12T25U535">Bij</span>(<span class="mxinfo " id="T35:U401">1:6</span>,<span class="mxinfo " id="T35:U402">1:6</span>,<span class="mxinfo " id="T5:U403"><span class="var type1" id="S27T64U543">child</span>(<span class="var type1" id="S34T5U544">k</span>)</span>,<span class="var type1" id="S23T5U545">i</span>)</span>'</span>*<span class="mxinfo " id="T27:U407"><span class="var type1" id="S33T25U547">Hij_tilde</span>(<span class="mxinfo " id="T35:U409">1:6</span>,<span class="mxinfo " id="T35:U410">1:6</span>,<span class="mxinfo " id="T5:U411"><span class="var type1" id="S27T64U555">child</span>(<span class="var type1" id="S34T5U556">k</span>)</span>,<span class="var type1" id="S23T5U557">i</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,136" id="srcline136">136</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,137" id="srcline137">137</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,138" id="srcline138">138</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,139" id="srcline139">139</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,140" id="srcline140">140</a></span><span class="line"><span class="comment">%Pre-allocate Hi0_tilde and H0j_tilde</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo " id="T26:U415"><span class="var type1" id="S35T26U560">Hi0_tilde</span>=<span class="mxinfo " id="T26:U417">zeros(<span class="mxinfo " id="T5:U418">6</span>,<span class="mxinfo " id="T5:U419">6</span>,<span class="var type1" id="S18T5U565">n</span>,<span class="string">'like'</span>,<span class="var type1" id="S6T2U567">t0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,142" id="srcline142">142</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,143" id="srcline143">143</a></span><span class="line"><span class="comment">%Hi0_tilde</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,144" id="srcline144">144</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T5U570">i</span>=<span class="mxinfo " id="T16:U423"><span class="var type1" id="S18T5U573">n</span>:<span class="mxinfo " id="T5:U425">-1</span>:1</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,145" id="srcline145">145</a></span><span class="line">    <span class="mxinfo " id="T27:U426"><span class="var type1" id="S36T27U579">Bdot</span>=<span class="mxinfo " id="T27:U428">[<span class="mxinfo " id="T63:U429">zeros(<span class="mxinfo " id="T5:U430">3</span>,<span class="mxinfo " id="T5:U431">3</span>), zeros(<span class="mxinfo " id="T5:U432">3</span>,<span class="mxinfo " id="T5:U433">3</span>)</span>; <span class="mxinfo " id="T63:U434"><span class="mxinfo " id="T4:U435"><span class="fcn" id="F58N18:B592">SkewSym</span>(<span class="mxinfo " id="T3:U436"><span class="mxinfo " id="T3:U437"><span class="var type1" id="S6T2U595">t0</span>(<span class="mxinfo " id="T71:U439">4:6</span>)</span>-<span class="mxinfo " id="T3:U440"><span class="var type1" id="S7T28U600">tL</span>(<span class="mxinfo " id="T46:U442"><span class="mxinfo " id="T5:U443">4</span>:<span class="mxinfo " id="T5:U444">6</span></span>,<span class="var type1" id="S23T5U604">i</span>)</span></span>)</span>, <span class="mxinfo " id="T4:U446">zeros(<span class="mxinfo " id="T5:U447">3</span>,<span class="mxinfo " id="T5:U448">3</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,146" id="srcline146">146</a></span><span class="line">    <span class="mxinfo " id="T27:U449"><span class="mxinfo " id="T27:U450"><span class="var type1" id="S35T26U612">Hi0_tilde</span>(<span class="mxinfo " id="T62:U452"><span class="mxinfo " id="T5:U453">1</span>:<span class="mxinfo " id="T5:U454">6</span></span>,<span class="mxinfo " id="T62:U455"><span class="mxinfo " id="T5:U456">1</span>:<span class="mxinfo " id="T5:U457">6</span></span>,<span class="var type1" id="S23T5U619">i</span>)</span>=<span class="mxinfo " id="T27:U459"><span class="mxinfo " id="T27:U460"><span class="var type1" id="S11T26U622">Mm_tilde</span>(<span class="mxinfo " id="T35:U462">1:6</span>,<span class="mxinfo " id="T35:U463">1:6</span>,<span class="var type1" id="S23T5U629">i</span>)</span>*<span class="var type1" id="S36T27U630">Bdot</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,147" id="srcline147">147</a></span><span class="line">    <span class="comment">%Add children contributions</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,148" id="srcline148">148</a></span><span class="line">    <span class="mxinfo " id="T64:U466"><span class="var type1" id="S27T64U633">child</span>=<span class="mxinfo " id="T64:U468"><span class="mxinfo " id="T65:U469">find(<span class="mxinfo " id="T16:U470"><span class="mxinfo " id="T15:U471"><span class="mxinfo " id="T14:U472"><span class="var type1" id="S16T19U640">robot</span>.con</span>.child</span>(<span class="mxinfo " id="T66:U474">:</span>,<span class="var type1" id="S23T5U644">i</span>)</span>)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,149" id="srcline149">149</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S34T5U647">k</span>=<span class="mxinfo " id="T65:U477"><span class="mxinfo " id="T5:U478">1</span>:<span class="mxinfo " id="T5:U479">length(<span class="var type1" id="S27T64U652">child</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,150" id="srcline150">150</a></span><span class="line">        <span class="mxinfo " id="T27:U481"><span class="mxinfo " id="T27:U482"><span class="var type1" id="S35T26U656">Hi0_tilde</span>(<span class="mxinfo " id="T62:U484"><span class="mxinfo " id="T5:U485">1</span>:<span class="mxinfo " id="T5:U486">6</span></span>,<span class="mxinfo " id="T62:U487"><span class="mxinfo " id="T5:U488">1</span>:<span class="mxinfo " id="T5:U489">6</span></span>,<span class="var type1" id="S23T5U663">i</span>)</span>=<span class="mxinfo " id="T27:U491"><span class="mxinfo " id="T27:U492"><span class="var type1" id="S35T26U666">Hi0_tilde</span>(<span class="mxinfo " id="T62:U494"><span class="mxinfo " id="T5:U495">1</span>:<span class="mxinfo " id="T5:U496">6</span></span>,<span class="mxinfo " id="T62:U497"><span class="mxinfo " id="T5:U498">1</span>:<span class="mxinfo " id="T5:U499">6</span></span>,<span class="var type1" id="S23T5U673">i</span>)</span>+<span class="mxinfo " id="T27:U501"><span class="mxinfo " id="T27:U502"><span class="mxinfo " id="T27:U503"><span class="var type1" id="S12T25U677">Bij</span>(<span class="mxinfo " id="T35:U505">1:6</span>,<span class="mxinfo " id="T35:U506">1:6</span>,<span class="mxinfo " id="T5:U507"><span class="var type1" id="S27T64U685">child</span>(<span class="var type1" id="S34T5U686">k</span>)</span>,<span class="var type1" id="S23T5U687">i</span>)</span>'</span>*<span class="mxinfo " id="T27:U511"><span class="var type1" id="S33T25U689">Hij_tilde</span>(<span class="mxinfo " id="T35:U513">1:6</span>,<span class="mxinfo " id="T35:U514">1:6</span>,<span class="mxinfo " id="T5:U515"><span class="var type1" id="S27T64U697">child</span>(<span class="var type1" id="S34T5U698">k</span>)</span>,<span class="var type1" id="S23T5U699">i</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,151" id="srcline151">151</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,152" id="srcline152">152</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,153" id="srcline153">153</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,154" id="srcline154">154</a></span><span class="line"><span class="comment">%--- C Matrix ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,155" id="srcline155">155</a></span><span class="line"><span class="comment">%Pre-allocate</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,156" id="srcline156">156</a></span><span class="line"><span class="mxinfo " id="T30:U519"><span class="var type1" id="S5T30U702">Cm</span>=<span class="mxinfo " id="T30:U521">zeros(<span class="var type1" id="S17T5U705">n_q</span>,<span class="var type1" id="S17T5U706">n_q</span>,<span class="string">'like'</span>,<span class="var type1" id="S6T2U708">t0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,157" id="srcline157">157</a></span><span class="line"><span class="mxinfo " id="T29:U525"><span class="var type1" id="S3T29U711">C0m</span>=<span class="mxinfo " id="T29:U527">zeros(<span class="mxinfo " id="T5:U528">6</span>,<span class="var type1" id="S17T5U715">n_q</span>,<span class="string">'like'</span>,<span class="var type1" id="S6T2U717">t0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,158" id="srcline158">158</a></span><span class="line"><span class="mxinfo " id="T31:U531"><span class="var type1" id="S4T31U720">Cm0</span>=<span class="mxinfo " id="T31:U533">zeros(<span class="var type1" id="S17T5U723">n_q</span>,<span class="mxinfo " id="T5:U535">6</span>,<span class="string">'like'</span>,<span class="var type1" id="S6T2U726">t0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,159" id="srcline159">159</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,160" id="srcline160">160</a></span><span class="line"><span class="comment">%Cm Matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,161" id="srcline161">161</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T5U729">j</span>=<span class="mxinfo " id="T16:U538"><span class="mxinfo " id="T5:U539">1</span>:<span class="var type1" id="S18T5U732">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,162" id="srcline162">162</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S23T5U735">i</span>=<span class="mxinfo " id="T16:U542"><span class="mxinfo " id="T5:U543">1</span>:<span class="var type1" id="S18T5U738">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,163" id="srcline163">163</a></span><span class="line">        <span class="comment">%Joints must not be fixed and links on the same branch</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,164" id="srcline164">164</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T44:U545"><span class="mxinfo " id="T5:U546"><span class="mxinfo " id="T43:U547"><span class="mxinfo " id="T7:U548"><span class="var type1" id="S16T19U748">robot</span>.joints</span>(<span class="var type1" id="S23T5U750">i</span>)</span>.type</span>~=<span class="mxinfo " id="T5:U551">0</span></span> &amp;&amp; <span class="mxinfo " id="T44:U552"><span class="mxinfo " id="T5:U553"><span class="mxinfo " id="T43:U554"><span class="mxinfo " id="T7:U555"><span class="var type1" id="S16T19U757">robot</span>.joints</span>(<span class="var type1" id="S29T5U759">j</span>)</span>.type</span>~=<span class="mxinfo " id="T5:U558">0</span></span>) &amp;&amp; (<span class="mxinfo " id="T44:U559"><span class="mxinfo " id="T5:U560"><span class="mxinfo " id="T15:U561"><span class="mxinfo " id="T14:U562"><span class="var type1" id="S16T19U768">robot</span>.con</span>.branch</span>(<span class="var type1" id="S23T5U771">i</span>,<span class="var type1" id="S29T5U772">j</span>)</span>==<span class="mxinfo " id="T5:U566">1</span></span> || <span class="mxinfo " id="T44:U567"><span class="mxinfo " id="T5:U568"><span class="mxinfo " id="T15:U569"><span class="mxinfo " id="T14:U570"><span class="var type1" id="S16T19U778">robot</span>.con</span>.branch</span>(<span class="var type1" id="S29T5U781">j</span>,<span class="var type1" id="S23T5U782">i</span>)</span>==<span class="mxinfo " id="T5:U574">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="45,165" id="srcline165">165</a></span><span class="line">            <span class="comment">%Compute Cm matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,166" id="srcline166">166</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T44:U575"><span class="var type1" id="S23T5U787">i</span>&lt;=<span class="var type1" id="S29T5U788">j</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,167" id="srcline167">167</a></span><span class="line">                <span class="comment">%Add children contributions</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,168" id="srcline168">168</a></span><span class="line">                <span class="mxinfo " id="T27:U578"><span class="var type1" id="S37T27U791">child_con</span>=<span class="mxinfo " id="T27:U580">zeros(<span class="mxinfo " id="T5:U581">6</span>,<span class="mxinfo " id="T5:U582">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,169" id="srcline169">169</a></span><span class="line">                <span class="mxinfo " id="T64:U583"><span class="var type1" id="S27T64U798">child</span>=<span class="mxinfo " id="T64:U585"><span class="mxinfo " id="T65:U586">find(<span class="mxinfo " id="T16:U587"><span class="mxinfo " id="T15:U588"><span class="mxinfo " id="T14:U589"><span class="var type1" id="S16T19U805">robot</span>.con</span>.child</span>(<span class="mxinfo " id="T66:U591">:</span>,<span class="var type1" id="S29T5U809">j</span>)</span>)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,170" id="srcline170">170</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S34T5U812">k</span>=<span class="mxinfo " id="T65:U594"><span class="mxinfo " id="T5:U595">1</span>:<span class="mxinfo " id="T5:U596">length(<span class="var type1" id="S27T64U817">child</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,171" id="srcline171">171</a></span><span class="line">                    <span class="mxinfo " id="T27:U598"><span class="var type1" id="S37T27U820">child_con</span>=<span class="mxinfo " id="T27:U600"><span class="var type1" id="S37T27U822">child_con</span>+<span class="mxinfo " id="T27:U602"><span class="mxinfo " id="T27:U603"><span class="mxinfo " id="T27:U604"><span class="var type1" id="S12T25U826">Bij</span>(<span class="mxinfo " id="T35:U606">1:6</span>,<span class="mxinfo " id="T35:U607">1:6</span>,<span class="mxinfo " id="T5:U608"><span class="var type1" id="S27T64U834">child</span>(<span class="var type1" id="S34T5U835">k</span>)</span>,<span class="var type1" id="S23T5U836">i</span>)</span>'</span>*<span class="mxinfo " id="T27:U612"><span class="var type1" id="S33T25U838">Hij_tilde</span>(<span class="mxinfo " id="T35:U614">1:6</span>,<span class="mxinfo " id="T35:U615">1:6</span>,<span class="mxinfo " id="T5:U616"><span class="var type1" id="S27T64U846">child</span>(<span class="var type1" id="S34T5U847">k</span>)</span>,<span class="var type1" id="S29T5U848">j</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,172" id="srcline172">172</a></span><span class="line">                <span class="keyword">end</span>                </span></span>
<span class="srcline"><span class="lineno"><a href="45,173" id="srcline173">173</a></span><span class="line">                <span class="mxinfo " id="T5:U620"><span class="mxinfo " id="T5:U621"><span class="var type1" id="S5T30U852">Cm</span>(<span class="mxinfo " id="T5:U623"><span class="mxinfo " id="T43:U624"><span class="mxinfo " id="T7:U625"><span class="var type1" id="S16T19U856">robot</span>.joints</span>(<span class="var type1" id="S23T5U858">i</span>)</span>.q_id</span>,<span class="mxinfo " id="T5:U628"><span class="mxinfo " id="T43:U629"><span class="mxinfo " id="T7:U630"><span class="var type1" id="S16T19U863">robot</span>.joints</span>(<span class="var type1" id="S29T5U865">j</span>)</span>.q_id</span>)</span>=<span class="mxinfo " id="T5:U633"><span class="mxinfo " id="T62:U634"><span class="mxinfo " id="T62:U635"><span class="mxinfo " id="T2:U636"><span class="var type1" id="S15T28U871">pm</span>(<span class="mxinfo " id="T35:U638">1:6</span>,<span class="var type1" id="S23T5U875">i</span>)</span>'</span>*(<span class="mxinfo " id="T27:U640"><span class="mxinfo " id="T27:U641"><span class="mxinfo " id="T27:U642"><span class="mxinfo " id="T27:U643"><span class="mxinfo " id="T27:U644"><span class="mxinfo " id="T27:U645"><span class="var type1" id="S12T25U883">Bij</span>(<span class="mxinfo " id="T35:U647">1:6</span>,<span class="mxinfo " id="T35:U648">1:6</span>,<span class="var type1" id="S29T5U890">j</span>,<span class="var type1" id="S23T5U891">i</span>)</span>'</span>*<span class="mxinfo " id="T27:U651"><span class="var type1" id="S11T26U893">Mm_tilde</span>(<span class="mxinfo " id="T35:U653">1:6</span>,<span class="mxinfo " id="T35:U654">1:6</span>,<span class="var type1" id="S29T5U900">j</span>)</span></span>*<span class="mxinfo " id="T27:U656"><span class="var type1" id="S22T26U902">Omega</span>(<span class="mxinfo " id="T35:U658">1:6</span>,<span class="mxinfo " id="T35:U659">1:6</span>,<span class="var type1" id="S29T5U909">j</span>)</span></span>+<span class="var type1" id="S37T27U910">child_con</span></span>+<span class="mxinfo " id="T27:U662"><span class="var type1" id="S26T26U912">Mdot_tilde</span>(<span class="mxinfo " id="T62:U664"><span class="mxinfo " id="T5:U665">1</span>:<span class="mxinfo " id="T5:U666">6</span></span>,<span class="mxinfo " id="T62:U667"><span class="mxinfo " id="T5:U668">1</span>:<span class="mxinfo " id="T5:U669">6</span></span>,<span class="var type1" id="S29T5U919">j</span>)</span></span>)</span>*<span class="mxinfo " id="T2:U671"><span class="var type1" id="S15T28U921">pm</span>(<span class="mxinfo " id="T35:U673">1:6</span>,<span class="var type1" id="S29T5U925">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,174" id="srcline174">174</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,175" id="srcline175">175</a></span><span class="line">                <span class="mxinfo " id="T5:U675"><span class="mxinfo " id="T5:U676"><span class="var type1" id="S5T30U930">Cm</span>(<span class="mxinfo " id="T5:U678"><span class="mxinfo " id="T43:U679"><span class="mxinfo " id="T7:U680"><span class="var type1" id="S16T19U934">robot</span>.joints</span>(<span class="var type1" id="S23T5U936">i</span>)</span>.q_id</span>,<span class="mxinfo " id="T5:U683"><span class="mxinfo " id="T43:U684"><span class="mxinfo " id="T7:U685"><span class="var type1" id="S16T19U941">robot</span>.joints</span>(<span class="var type1" id="S29T5U943">j</span>)</span>.q_id</span>)</span>=<span class="mxinfo " id="T5:U688"><span class="mxinfo " id="T62:U689"><span class="mxinfo " id="T62:U690"><span class="mxinfo " id="T2:U691"><span class="var type1" id="S15T28U949">pm</span>(<span class="mxinfo " id="T35:U693">1:6</span>,<span class="var type1" id="S23T5U953">i</span>)</span>'</span>*(<span class="mxinfo " id="T27:U695"><span class="mxinfo " id="T27:U696"><span class="mxinfo " id="T27:U697"><span class="mxinfo " id="T27:U698"><span class="mxinfo " id="T27:U699"><span class="var type1" id="S11T26U960">Mm_tilde</span>(<span class="mxinfo " id="T35:U701">1:6</span>,<span class="mxinfo " id="T35:U702">1:6</span>,<span class="var type1" id="S23T5U967">i</span>)</span>*<span class="mxinfo " id="T27:U704"><span class="var type1" id="S12T25U969">Bij</span>(<span class="mxinfo " id="T35:U706">1:6</span>,<span class="mxinfo " id="T35:U707">1:6</span>,<span class="var type1" id="S23T5U976">i</span>,<span class="var type1" id="S29T5U977">j</span>)</span></span>*<span class="mxinfo " id="T27:U710"><span class="var type1" id="S22T26U979">Omega</span>(<span class="mxinfo " id="T35:U712">1:6</span>,<span class="mxinfo " id="T35:U713">1:6</span>,<span class="var type1" id="S29T5U986">j</span>)</span></span>+<span class="mxinfo " id="T27:U715"><span class="var type1" id="S33T25U988">Hij_tilde</span>(<span class="mxinfo " id="T62:U717"><span class="mxinfo " id="T5:U718">1</span>:<span class="mxinfo " id="T5:U719">6</span></span>,<span class="mxinfo " id="T62:U720"><span class="mxinfo " id="T5:U721">1</span>:<span class="mxinfo " id="T5:U722">6</span></span>,<span class="var type1" id="S23T5U995">i</span>,<span class="var type1" id="S29T5U996">j</span>)</span></span>+<span class="mxinfo " id="T27:U725"><span class="var type1" id="S26T26U998">Mdot_tilde</span>(<span class="mxinfo " id="T62:U727"><span class="mxinfo " id="T5:U728">1</span>:<span class="mxinfo " id="T5:U729">6</span></span>,<span class="mxinfo " id="T62:U730"><span class="mxinfo " id="T5:U731">1</span>:<span class="mxinfo " id="T5:U732">6</span></span>,<span class="var type1" id="S23T5U1005">i</span>)</span></span>)</span>*<span class="mxinfo " id="T2:U734"><span class="var type1" id="S15T28U1007">pm</span>(<span class="mxinfo " id="T35:U736">1:6</span>,<span class="var type1" id="S29T5U1011">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,176" id="srcline176">176</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,177" id="srcline177">177</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,178" id="srcline178">178</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,179" id="srcline179">179</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,180" id="srcline180">180</a></span><span class="line"><span class="comment">%C0 matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,181" id="srcline181">181</a></span><span class="line"><span class="comment">%Add children contributions</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,182" id="srcline182">182</a></span><span class="line"><span class="mxinfo " id="T27:U738"><span class="var type1" id="S37T27U1014">child_con</span>=<span class="mxinfo " id="T27:U740">zeros(<span class="mxinfo " id="T5:U741">6</span>,<span class="mxinfo " id="T5:U742">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,183" id="srcline183">183</a></span><span class="line"><span class="mxinfo " id="T64:U743"><span class="var type1" id="S27T64U1021">child</span>=<span class="mxinfo " id="T64:U745"><span class="mxinfo " id="T65:U746">find(<span class="var type1" id="S16T19U1027">robot</span>.con.child_base)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,184" id="srcline184">184</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T5U1032">k</span>=<span class="mxinfo " id="T65:U749"><span class="mxinfo " id="T5:U750">1</span>:<span class="mxinfo " id="T5:U751">length(<span class="var type1" id="S27T64U1037">child</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,185" id="srcline185">185</a></span><span class="line">    <span class="mxinfo " id="T27:U753"><span class="var type1" id="S37T27U1040">child_con</span>=<span class="mxinfo " id="T27:U755"><span class="var type1" id="S37T27U1042">child_con</span>+<span class="mxinfo " id="T27:U757"><span class="mxinfo " id="T27:U758"><span class="mxinfo " id="T27:U759"><span class="var type1" id="S13T26U1046">Bi0</span>(<span class="mxinfo " id="T35:U761">1:6</span>,<span class="mxinfo " id="T35:U762">1:6</span>,<span class="mxinfo " id="T5:U763"><span class="var type1" id="S27T64U1054">child</span>(<span class="var type1" id="S34T5U1055">k</span>)</span>)</span>'</span>*<span class="mxinfo " id="T27:U766"><span class="var type1" id="S35T26U1057">Hi0_tilde</span>(<span class="mxinfo " id="T35:U768">1:6</span>,<span class="mxinfo " id="T35:U769">1:6</span>,<span class="mxinfo " id="T5:U770"><span class="var type1" id="S27T64U1065">child</span>(<span class="var type1" id="S34T5U1066">k</span>)</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,186" id="srcline186">186</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,187" id="srcline187">187</a></span><span class="line"><span class="comment">%child_con</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,188" id="srcline188">188</a></span><span class="line"><span class="mxinfo " id="T27:U773"><span class="var type1" id="S2T27U1069">C0</span> = <span class="mxinfo " id="T27:U775"><span class="mxinfo " id="T27:U776"><span class="mxinfo " id="T27:U777"><span class="var type1" id="S14T27U1073">P0</span>'</span>*(<span class="mxinfo " id="T27:U779"><span class="mxinfo " id="T27:U780"><span class="mxinfo " id="T27:U781"><span class="var type1" id="S10T27U1078">M0_tilde</span>*<span class="var type1" id="S19T27U1079">Omega0</span></span>+<span class="var type1" id="S37T27U1080">child_con</span></span>+<span class="var type1" id="S31T27U1081">Mdot0_tilde</span></span>)</span>*<span class="var type1" id="S14T27U1082">P0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,189" id="srcline189">189</a></span><span class="line"><span class="comment">%C0m</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,190" id="srcline190">190</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T5U1085">j</span>=<span class="mxinfo " id="T16:U788"><span class="mxinfo " id="T5:U789">1</span>:<span class="var type1" id="S18T5U1088">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,191" id="srcline191">191</a></span><span class="line">    <span class="keyword">if</span>  <span class="mxinfo " id="T44:U791"><span class="mxinfo " id="T5:U792"><span class="mxinfo " id="T43:U793"><span class="mxinfo " id="T7:U794"><span class="var type1" id="S16T19U1095">robot</span>.joints</span>(<span class="var type1" id="S29T5U1097">j</span>)</span>.type</span>~=<span class="mxinfo " id="T5:U797">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,192" id="srcline192">192</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T44:U798"><span class="var type1" id="S29T5U1103">j</span>==<span class="var type1" id="S18T5U1104">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,193" id="srcline193">193</a></span><span class="line">            <span class="mxinfo " id="T2:U801"><span class="mxinfo " id="T2:U802"><span class="var type1" id="S3T29U1108">C0m</span>(<span class="mxinfo " id="T62:U804"><span class="mxinfo " id="T5:U805">1</span>:<span class="mxinfo " id="T5:U806">6</span></span>,<span class="mxinfo " id="T5:U807"><span class="mxinfo " id="T43:U808"><span class="mxinfo " id="T7:U809"><span class="var type1" id="S16T19U1115">robot</span>.joints</span>(<span class="var type1" id="S29T5U1117">j</span>)</span>.q_id</span>)</span>=<span class="mxinfo " id="T2:U812"><span class="mxinfo " id="T27:U813"><span class="mxinfo " id="T27:U814"><span class="var type1" id="S14T27U1122">P0</span>'</span>*(<span class="mxinfo " id="T27:U816"><span class="mxinfo " id="T27:U817"><span class="mxinfo " id="T27:U818"><span class="mxinfo " id="T27:U819"><span class="mxinfo " id="T27:U820"><span class="var type1" id="S13T26U1129">Bi0</span>(<span class="mxinfo " id="T35:U822">1:6</span>,<span class="mxinfo " id="T35:U823">1:6</span>,<span class="var type1" id="S29T5U1136">j</span>)</span>'</span>*<span class="mxinfo " id="T27:U825"><span class="var type1" id="S11T26U1138">Mm_tilde</span>(<span class="mxinfo " id="T35:U827">1:6</span>,<span class="mxinfo " id="T35:U828">1:6</span>,<span class="var type1" id="S29T5U1145">j</span>)</span></span>*<span class="mxinfo " id="T27:U830"><span class="var type1" id="S22T26U1147">Omega</span>(<span class="mxinfo " id="T35:U832">1:6</span>,<span class="mxinfo " id="T35:U833">1:6</span>,<span class="var type1" id="S29T5U1154">j</span>)</span></span>+<span class="mxinfo " id="T27:U835"><span class="var type1" id="S26T26U1156">Mdot_tilde</span>(<span class="mxinfo " id="T62:U837"><span class="mxinfo " id="T5:U838">1</span>:<span class="mxinfo " id="T5:U839">6</span></span>,<span class="mxinfo " id="T62:U840"><span class="mxinfo " id="T5:U841">1</span>:<span class="mxinfo " id="T5:U842">6</span></span>,<span class="var type1" id="S29T5U1163">j</span>)</span></span>)</span>*<span class="mxinfo " id="T2:U844"><span class="var type1" id="S15T28U1165">pm</span>(<span class="mxinfo " id="T35:U846">1:6</span>,<span class="var type1" id="S29T5U1169">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,194" id="srcline194">194</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,195" id="srcline195">195</a></span><span class="line">            <span class="comment">%Add children contributions</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,196" id="srcline196">196</a></span><span class="line">            <span class="mxinfo " id="T27:U848"><span class="var type1" id="S37T27U1173">child_con</span>=<span class="mxinfo " id="T27:U850">zeros(<span class="mxinfo " id="T5:U851">6</span>,<span class="mxinfo " id="T5:U852">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,197" id="srcline197">197</a></span><span class="line">            <span class="mxinfo " id="T64:U853"><span class="var type1" id="S27T64U1180">child</span>=<span class="mxinfo " id="T64:U855"><span class="mxinfo " id="T65:U856">find(<span class="mxinfo " id="T16:U857"><span class="mxinfo " id="T15:U858"><span class="mxinfo " id="T14:U859"><span class="var type1" id="S16T19U1187">robot</span>.con</span>.child</span>(<span class="mxinfo " id="T66:U861">:</span>,<span class="var type1" id="S29T5U1191">j</span>)</span>)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,198" id="srcline198">198</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S34T5U1194">k</span>=<span class="mxinfo " id="T65:U864"><span class="mxinfo " id="T5:U865">1</span>:<span class="mxinfo " id="T5:U866">length(<span class="var type1" id="S27T64U1199">child</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,199" id="srcline199">199</a></span><span class="line">                <span class="mxinfo " id="T27:U868"><span class="var type1" id="S37T27U1202">child_con</span>=<span class="mxinfo " id="T27:U870"><span class="var type1" id="S37T27U1204">child_con</span>+<span class="mxinfo " id="T27:U872"><span class="mxinfo " id="T27:U873"><span class="mxinfo " id="T27:U874"><span class="var type1" id="S13T26U1208">Bi0</span>(<span class="mxinfo " id="T35:U876">1:6</span>,<span class="mxinfo " id="T35:U877">1:6</span>,<span class="mxinfo " id="T5:U878"><span class="var type1" id="S27T64U1216">child</span>(<span class="var type1" id="S34T5U1217">k</span>)</span>)</span>'</span>*<span class="mxinfo " id="T27:U881"><span class="var type1" id="S33T25U1219">Hij_tilde</span>(<span class="mxinfo " id="T35:U883">1:6</span>,<span class="mxinfo " id="T35:U884">1:6</span>,<span class="mxinfo " id="T5:U885"><span class="var type1" id="S27T64U1227">child</span>(<span class="var type1" id="S34T5U1228">k</span>)</span>,<span class="var type1" id="S29T5U1229">j</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,200" id="srcline200">200</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,201" id="srcline201">201</a></span><span class="line">            <span class="mxinfo " id="T2:U889"><span class="mxinfo " id="T2:U890"><span class="var type1" id="S3T29U1233">C0m</span>(<span class="mxinfo " id="T62:U892"><span class="mxinfo " id="T5:U893">1</span>:<span class="mxinfo " id="T5:U894">6</span></span>,<span class="mxinfo " id="T5:U895"><span class="mxinfo " id="T43:U896"><span class="mxinfo " id="T7:U897"><span class="var type1" id="S16T19U1240">robot</span>.joints</span>(<span class="var type1" id="S29T5U1242">j</span>)</span>.q_id</span>)</span>=<span class="mxinfo " id="T2:U900"><span class="mxinfo " id="T27:U901"><span class="mxinfo " id="T27:U902"><span class="var type1" id="S14T27U1247">P0</span>'</span>*(<span class="mxinfo " id="T27:U904"><span class="mxinfo " id="T27:U905"><span class="mxinfo " id="T27:U906"><span class="mxinfo " id="T27:U907"><span class="mxinfo " id="T27:U908"><span class="mxinfo " id="T27:U909"><span class="var type1" id="S13T26U1255">Bi0</span>(<span class="mxinfo " id="T35:U911">1:6</span>,<span class="mxinfo " id="T35:U912">1:6</span>,<span class="var type1" id="S29T5U1262">j</span>)</span>'</span>*<span class="mxinfo " id="T27:U914"><span class="var type1" id="S11T26U1264">Mm_tilde</span>(<span class="mxinfo " id="T35:U916">1:6</span>,<span class="mxinfo " id="T35:U917">1:6</span>,<span class="var type1" id="S29T5U1271">j</span>)</span></span>*<span class="mxinfo " id="T27:U919"><span class="var type1" id="S22T26U1273">Omega</span>(<span class="mxinfo " id="T35:U921">1:6</span>,<span class="mxinfo " id="T35:U922">1:6</span>,<span class="var type1" id="S29T5U1280">j</span>)</span></span>+<span class="var type1" id="S37T27U1281">child_con</span></span>+<span class="mxinfo " id="T27:U925"><span class="var type1" id="S26T26U1283">Mdot_tilde</span>(<span class="mxinfo " id="T62:U927"><span class="mxinfo " id="T5:U928">1</span>:<span class="mxinfo " id="T5:U929">6</span></span>,<span class="mxinfo " id="T62:U930"><span class="mxinfo " id="T5:U931">1</span>:<span class="mxinfo " id="T5:U932">6</span></span>,<span class="var type1" id="S29T5U1290">j</span>)</span></span>)</span>*<span class="mxinfo " id="T2:U934"><span class="var type1" id="S15T28U1292">pm</span>(<span class="mxinfo " id="T35:U936">1:6</span>,<span class="var type1" id="S29T5U1296">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,202" id="srcline202">202</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,203" id="srcline203">203</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,204" id="srcline204">204</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,205" id="srcline205">205</a></span><span class="line"><span class="comment">%Cm0</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,206" id="srcline206">206</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T5U1299">i</span>=<span class="mxinfo " id="T16:U939"><span class="mxinfo " id="T5:U940">1</span>:<span class="var type1" id="S18T5U1302">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,207" id="srcline207">207</a></span><span class="line">    <span class="keyword">if</span>  <span class="mxinfo " id="T44:U942"><span class="mxinfo " id="T5:U943"><span class="mxinfo " id="T43:U944"><span class="mxinfo " id="T7:U945"><span class="var type1" id="S16T19U1309">robot</span>.joints</span>(<span class="var type1" id="S23T5U1311">i</span>)</span>.type</span>~=<span class="mxinfo " id="T5:U948">0</span></span>  </span></span>
<span class="srcline"><span class="lineno"><a href="45,208" id="srcline208">208</a></span><span class="line">        <span class="mxinfo " id="T62:U949"><span class="mxinfo " id="T62:U950"><span class="var type1" id="S4T31U1317">Cm0</span>(<span class="mxinfo " id="T5:U952"><span class="mxinfo " id="T43:U953"><span class="mxinfo " id="T7:U954"><span class="var type1" id="S16T19U1321">robot</span>.joints</span>(<span class="var type1" id="S23T5U1323">i</span>)</span>.q_id</span>,<span class="mxinfo " id="T62:U957"><span class="mxinfo " id="T5:U958">1</span>:<span class="mxinfo " id="T5:U959">6</span></span>)</span>=<span class="mxinfo " id="T62:U960"><span class="mxinfo " id="T62:U961"><span class="mxinfo " id="T62:U962"><span class="mxinfo " id="T2:U963"><span class="var type1" id="S15T28U1332">pm</span>(<span class="mxinfo " id="T35:U965">1:6</span>,<span class="var type1" id="S23T5U1336">i</span>)</span>'</span>*(<span class="mxinfo " id="T27:U967"><span class="mxinfo " id="T27:U968"><span class="mxinfo " id="T27:U969"><span class="mxinfo " id="T27:U970"><span class="mxinfo " id="T27:U971"><span class="var type1" id="S11T26U1343">Mm_tilde</span>(<span class="mxinfo " id="T35:U973">1:6</span>,<span class="mxinfo " id="T35:U974">1:6</span>,<span class="var type1" id="S23T5U1350">i</span>)</span>*<span class="mxinfo " id="T27:U976"><span class="var type1" id="S13T26U1352">Bi0</span>(<span class="mxinfo " id="T35:U978">1:6</span>,<span class="mxinfo " id="T35:U979">1:6</span>,<span class="var type1" id="S23T5U1359">i</span>)</span></span>*<span class="var type1" id="S19T27U1360">Omega0</span></span>+<span class="mxinfo " id="T27:U982"><span class="var type1" id="S35T26U1362">Hi0_tilde</span>(<span class="mxinfo " id="T62:U984"><span class="mxinfo " id="T5:U985">1</span>:<span class="mxinfo " id="T5:U986">6</span></span>,<span class="mxinfo " id="T62:U987"><span class="mxinfo " id="T5:U988">1</span>:<span class="mxinfo " id="T5:U989">6</span></span>,<span class="var type1" id="S23T5U1369">i</span>)</span></span>+<span class="mxinfo " id="T27:U991"><span class="var type1" id="S26T26U1371">Mdot_tilde</span>(<span class="mxinfo " id="T62:U993"><span class="mxinfo " id="T5:U994">1</span>:<span class="mxinfo " id="T5:U995">6</span></span>,<span class="mxinfo " id="T62:U996"><span class="mxinfo " id="T5:U997">1</span>:<span class="mxinfo " id="T5:U998">6</span></span>,<span class="var type1" id="S23T5U1378">i</span>)</span></span>)</span>*<span class="var type1" id="S14T27U1379">P0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,209" id="srcline209">209</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,210" id="srcline210">210</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,211" id="srcline211">211</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,212" id="srcline212">212</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,213" id="srcline213">213</a></span><span class="line"></span></span>
</pre>
</body>
</html>
