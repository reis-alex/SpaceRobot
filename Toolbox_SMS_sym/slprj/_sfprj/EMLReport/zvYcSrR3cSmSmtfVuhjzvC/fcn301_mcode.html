<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="117,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">w_ref</span>,<span class="var type1" id="S3T3U4">rL_EE</span>]= fcn(<span class="var type1" id="S4T4U7">R0</span>,<span class="var type1" id="S5T3U8">r0</span>,<span class="var type1" id="S6T2U9">q_ref</span>,<span class="var type1" id="S7T2U10">qdot_ref</span>,<span class="var type1" id="S8T2U11">u0</span>, <span class="var type1" id="S9T5U12">is_captured</span>,<span class="var type2" id="S10T6V1U13">robot_pre_sim</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="117,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T1:U10"><span class="var type1" id="S11T1U16">qm</span> = <span class="mxinfo " id="T1:U12">[<span class="mxinfo " id="T3:U13">zeros(<span class="mxinfo " id="T5:U14"><span class="var type1" id="S10T6U23">robot_pre_sim</span>.dimensions.dim_r</span>,1)</span>;<span class="var type1" id="S6T2U28">q_ref</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T1:U17"><span class="var type1" id="S13T1U31">qmdot</span> = <span class="mxinfo " id="T1:U19">[<span class="mxinfo " id="T3:U20">0*150*ones(<span class="mxinfo " id="T5:U21"><span class="var type1" id="S10T6U42">robot_pre_sim</span>.dimensions.dim_r</span>,1)</span>;<span class="var type1" id="S7T2U47">qdot_ref</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,8" id="srcline8"> 8</a></span><span class="line">[<span class="mxinfo " id="T23:U24">~</span>,<span class="var type1" id="S15T23U52">RL</span>,<span class="mxinfo " id="T24:U26">~</span>,<span class="var type1" id="S16T24U54">rL</span>,<span class="var type1" id="S17T24U55">e</span>,<span class="var type1" id="S18T24U56">g</span>]    =   <span class="fcn" id="F2N14:B58">Kinematics</span>(<span class="var type1" id="S4T4U59">R0</span>,<span class="var type1" id="S5T3U60">r0</span>,<span class="var type1" id="S11T1U61">qm</span>,<span class="var type1" id="S10T6U62">robot_pre_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="117,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%Diferential Kinematics</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,10" id="srcline10">10</a></span><span class="line">[<span class="var type1" id="S20T25U66">Bij</span>,<span class="var type1" id="S21T26U67">Bi0</span>,<span class="var type1" id="S22T27U68">P0</span>,<span class="var type1" id="S23T28U69">pm</span>]     =   <span class="fcn" id="F57N5:B71">DiffKinematics</span>(<span class="var type1" id="S4T4U72">R0</span>,<span class="var type1" id="S5T3U73">r0</span>,<span class="var type1" id="S16T24U74">rL</span>,<span class="var type1" id="S17T24U75">e</span>,<span class="var type1" id="S18T24U76">g</span>,<span class="var type1" id="S10T6U77">robot_pre_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="117,11" id="srcline11">11</a></span><span class="line">[<span class="var type1" id="S25T2U81">t0</span>,<span class="var type1" id="S26T28U82">tL</span>]             =   <span class="fcn" id="F60N19:B84">Velocities</span>(<span class="var type1" id="S20T25U85">Bij</span>,<span class="var type1" id="S21T26U86">Bi0</span>,<span class="var type1" id="S22T27U87">P0</span>,<span class="var type1" id="S23T28U88">pm</span>,<span class="var type1" id="S8T2U89">u0</span>,<span class="var type1" id="S13T1U90">qmdot</span>,<span class="var type1" id="S10T6U91">robot_pre_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="117,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T2:U53"><span class="var type1" id="S28T2U94">u_EE</span> = <span class="mxinfo " id="T2:U55"><span class="var type1" id="S26T28U96">tL</span>(<span class="mxinfo " id="T35:U57">:</span>,<span class="mxinfo " id="T37:U58"><span class="var type1" id="S10T6U99">robot_pre_sim</span>.id_EE</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T3:U60"><span class="var type1" id="S3T3U103">rL_EE</span>       = <span class="mxinfo " id="T3:U62"><span class="var type1" id="S16T24U105">rL</span>(<span class="mxinfo " id="T36:U64">:</span>,<span class="mxinfo " id="T5:U65"><span class="var type1" id="S10T6U108">robot_pre_sim</span>.id_EE</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,15" id="srcline15">15</a></span><span class="line"> <span class="comment">%--- Dynamics ---%</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,16" id="srcline16">16</a></span><span class="line"><span class="comment">%Inertias in inertial frames</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,17" id="srcline17">17</a></span><span class="line">[<span class="var type1" id="S29T4U113">I0</span>,<span class="var type1" id="S30T23U114">Im</span>]             =   <span class="fcn" id="F68N10:B116">I_I</span>(<span class="var type1" id="S4T4U117">R0</span>,<span class="var type1" id="S15T23U118">RL</span>,<span class="var type1" id="S10T6U119">robot_pre_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="117,18" id="srcline18">18</a></span><span class="line"><span class="comment">%Mass Composite Body matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,19" id="srcline19">19</a></span><span class="line">[<span class="var type1" id="S32T27U123">M0_tilde</span>,<span class="var type1" id="S33T26U124">Mm_tilde</span>] =   <span class="fcn" id="F72N15:B126">MCB</span>(<span class="var type1" id="S29T4U127">I0</span>,<span class="var type1" id="S30T23U128">Im</span>,<span class="var type1" id="S20T25U129">Bij</span>,<span class="var type1" id="S21T26U130">Bi0</span>,<span class="var type1" id="S10T6U131">robot_pre_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="117,20" id="srcline20">20</a></span><span class="line"><span class="comment">%Generalized Inertia matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,21" id="srcline21">21</a></span><span class="line">[<span class="var type1" id="S35T27U135">H0</span>,<span class="var type1" id="S36T29U136">H0q</span>,<span class="var type1" id="S37T30U137">Hq</span>]         =   <span class="fcn" id="F101N7:B139">GIM</span>(<span class="var type1" id="S32T27U140">M0_tilde</span>,<span class="var type1" id="S33T26U141">Mm_tilde</span>,<span class="var type1" id="S20T25U142">Bij</span>,<span class="var type1" id="S21T26U143">Bi0</span>,<span class="var type1" id="S22T27U144">P0</span>,<span class="var type1" id="S23T28U145">pm</span>,<span class="var type1" id="S10T6U146">robot_pre_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="117,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,24" id="srcline24">24</a></span><span class="line">[<span class="var type1" id="S39T27U150">J0EE</span>, <span class="var type1" id="S40T29U151">JmEE</span>]      =   <span class="fcn" id="F304N12:B153">Jacob</span>(<span class="mxinfo " id="T3:U91"><span class="var type1" id="S16T24U155">rL</span>(<span class="mxinfo " id="T36:U93">:</span>,<span class="mxinfo " id="T37:U94"><span class="var type1" id="S10T6U158">robot_pre_sim</span>.id_EE</span>)</span>,<span class="var type1" id="S5T3U160">r0</span>,<span class="var type1" id="S16T24U161">rL</span>,<span class="var type1" id="S22T27U162">P0</span>,<span class="var type1" id="S23T28U163">pm</span>,<span class="var type1" id="S10T6U165">robot_pre_sim</span>.id_EE,<span class="var type1" id="S10T6U167">robot_pre_sim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="117,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T3:U102"><span class="var type1" id="S42T3U170">w1</span> = <span class="mxinfo " id="T3:U104">zeros(<span class="mxinfo " id="T5:U105">3</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T65:U106"><span class="var type1" id="S42T65U177">w1</span> = <span class="mxinfo " id="T2:U108"><span class="mxinfo " id="T29:U109"><span class="mxinfo " id="T27:U110">-<span class="mxinfo " id="T27:U111">inv(<span class="var type1" id="S35T27U183">H0</span>)</span></span>*<span class="var type1" id="S36T29U184">H0q</span></span>*<span class="var type1" id="S13T1U185">qmdot</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T3:U115"><span class="var type1" id="S42T3U188">w1</span> = <span class="mxinfo " id="T3:U117"><span class="mxinfo " id="T5:U118">0</span>*<span class="mxinfo " id="T3:U119"><span class="var type1" id="S42T65U192">w1</span>(<span class="mxinfo " id="T46:U121"><span class="mxinfo " id="T5:U122">1</span>:<span class="mxinfo " id="T5:U123">3</span></span>,<span class="mxinfo " id="T37:U124">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T2:U125"><span class="var type1" id="S44T2U199">w2</span> = <span class="mxinfo " id="T2:U127"><span class="mxinfo " id="T2:U128"><span class="var type1" id="S39T27U202">J0EE</span>*<span class="var type1" id="S8T2U203">u0</span></span>+<span class="mxinfo " id="T2:U131"><span class="var type1" id="S40T29U205">JmEE</span>*<span class="var type1" id="S13T1U206">qmdot</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T2:U134"><span class="var type1" id="S44T2U209">w2</span> = <span class="var type1" id="S28T2U210">u_EE</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,33" id="srcline33">33</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S9T5U213">is_captured</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo " id="T2:U138"><span class="var type1" id="S44T2U216">w2</span> = <span class="mxinfo " id="T2:U140"><span class="mxinfo " id="T5:U141">0</span>*<span class="var type1" id="S28T2U219">u_EE</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,35" id="srcline35">35</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T2:U143"><span class="var type1" id="S44T2U223">w2</span> = <span class="var type1" id="S28T2U224">u_EE</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,37" id="srcline37">37</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,38" id="srcline38">38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo " id="T1:U146"><span class="var type1" id="S2T1U227">w_ref</span> = <span class="mxinfo " id="T1:U148">[<span class="var type1" id="S42T3U230">w1</span>;<span class="var type1" id="S44T2U232">w2</span>]</span></span>;</span></span>
</pre>
</body>
</html>
