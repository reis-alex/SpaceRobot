<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="39,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T27U3">M0_tilde</span>,<span class="var type1" id="S3T26U4">Mm_tilde</span>]=MCB(<span class="var type1" id="S4T4U7">I0</span>,<span class="var type1" id="S5T23U8">Im</span>,<span class="var type1" id="S6T25U9">Bij</span>,<span class="var type1" id="S7T26U10">Bi0</span>,<span class="var type2" id="S8T19V2U11">robot</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="39,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Computes the Mass Composite Body Matrix (MCB) of the multibody system.</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% [M0_tilde,Mm_tilde]=MCB(I0,Im,Bij,Bi0,robot)</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% :parameters: </span></span></span>
<span class="srcline"><span class="lineno"><a href="39,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%   * I0 -- Base-link inertia matrix, projected in the inertial CCS -- as a [3x3] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%   * Im -- Links inertia matrices, projected in the inertial CCS -- as a [3x3xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%   * Bij -- Twist-propagation matrix (for manipulator i&gt;0 and j&gt;0) -- as a [6x6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,10" id="srcline10">10</a></span><span class="line"><span class="comment">%   * Bi0 -- Twist-propagation matrix (for i&gt;0 and j=0) -- as a [6x6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,11" id="srcline11">11</a></span><span class="line"><span class="comment">%   * robot -- Robot model (see :doc:`/Tutorial_Robot`).</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,12" id="srcline12">12</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,13" id="srcline13">13</a></span><span class="line"><span class="comment">% :return: </span></span></span>
<span class="srcline"><span class="lineno"><a href="39,14" id="srcline14">14</a></span><span class="line"><span class="comment">%   * M0_tilde -- Base-link mass composite body matrix -- as a [6x6] matrix .</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,15" id="srcline15">15</a></span><span class="line"><span class="comment">%   * Mm_tilde -- Manipulator mass composite body matrix -- as a [6x6xn] matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,16" id="srcline16">16</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,17" id="srcline17">17</a></span><span class="line"><span class="comment">% See also: :func:`src.kinematics_dynamics.I_I`. </span></span></span>
<span class="srcline"><span class="lineno"><a href="39,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,19" id="srcline19">19</a></span><span class="line"><span class="comment"><span class="comment">%{  </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="39,20" id="srcline20">20</a></span><span class="line"><span class="comment">    LICENSE</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,22" id="srcline22">22</a></span><span class="line"><span class="comment">    This program is free software: you can redistribute it and/or modify</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,23" id="srcline23">23</a></span><span class="line"><span class="comment">    it under the terms of the GNU Lesser General Public License as published by</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,24" id="srcline24">24</a></span><span class="line"><span class="comment">    the Free Software Foundation, either version 3 of the License, or</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,25" id="srcline25">25</a></span><span class="line"><span class="comment">    (at your option) any later version.</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,26" id="srcline26">26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,27" id="srcline27">27</a></span><span class="line"><span class="comment">    This program is distributed in the hope that it will be useful,</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,28" id="srcline28">28</a></span><span class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,29" id="srcline29">29</a></span><span class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,30" id="srcline30">30</a></span><span class="line"><span class="comment">    GNU Lesser General Public License for more details.</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,32" id="srcline32">32</a></span><span class="line"><span class="comment">    You should have received a copy of the GNU Lesser General Public License</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,33" id="srcline33">33</a></span><span class="line"><span class="comment">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,34" id="srcline34">34</a></span><span class="line"><span class="comment"><span class="comment">%}</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="39,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,36" id="srcline36">36</a></span><span class="line"><span class="comment">%=== CODE ===%</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,37" id="srcline37">37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,38" id="srcline38">38</a></span><span class="line"><span class="comment">%Number of links and Joints</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo " id="T5:U8"><span class="var type1" id="S9T5U14">n</span>=<span class="mxinfo " id="T5:U10"><span class="var type1" id="S8T19U16">robot</span>.n_links_joints</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="39,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,41" id="srcline41">41</a></span><span class="line"><span class="comment">%Pre-allocate</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo " id="T26:U12"><span class="var type1" id="S3T26U20">Mm_tilde</span>=<span class="mxinfo " id="T26:U14">zeros(<span class="mxinfo " id="T5:U15">6</span>,<span class="mxinfo " id="T5:U16">6</span>,<span class="var type1" id="S9T5U25">n</span>,<span class="string">'like'</span>,<span class="var type1" id="S4T4U27">I0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="39,43" id="srcline43">43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,44" id="srcline44">44</a></span><span class="line"><span class="comment">%Backwards recursion</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,45" id="srcline45">45</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S11T5U30">i</span>=<span class="mxinfo " id="T16:U20"><span class="var type1" id="S9T5U33">n</span>:<span class="mxinfo " id="T5:U22">-1</span>:1</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,46" id="srcline46">46</a></span><span class="line">    <span class="comment">%Initialize M tilde</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo " id="T27:U23"><span class="mxinfo " id="T27:U24"><span class="var type1" id="S3T26U40">Mm_tilde</span>(<span class="mxinfo " id="T62:U26"><span class="mxinfo " id="T5:U27">1</span>:<span class="mxinfo " id="T5:U28">6</span></span>,<span class="mxinfo " id="T62:U29"><span class="mxinfo " id="T5:U30">1</span>:<span class="mxinfo " id="T5:U31">6</span></span>,<span class="var type1" id="S11T5U47">i</span>)</span>=<span class="mxinfo " id="T27:U33">[<span class="mxinfo " id="T63:U34"><span class="mxinfo " id="T4:U35"><span class="var type1" id="S5T23U51">Im</span>(<span class="mxinfo " id="T46:U37"><span class="mxinfo " id="T5:U38">1</span>:<span class="mxinfo " id="T5:U39">3</span></span>,<span class="mxinfo " id="T46:U40"><span class="mxinfo " id="T5:U41">1</span>:<span class="mxinfo " id="T5:U42">3</span></span>,<span class="var type1" id="S11T5U58">i</span>)</span>,<span class="mxinfo " id="T4:U44">zeros(<span class="mxinfo " id="T5:U45">3</span>,<span class="mxinfo " id="T5:U46">3</span>)</span></span>;<span class="mxinfo " id="T63:U47"><span class="mxinfo " id="T4:U48">zeros(<span class="mxinfo " id="T5:U49">3</span>,<span class="mxinfo " id="T5:U50">3</span>)</span>,<span class="mxinfo " id="T4:U51"><span class="mxinfo " id="T5:U52"><span class="mxinfo " id="T47:U53"><span class="mxinfo " id="T17:U54"><span class="var type1" id="S8T19U72">robot</span>.links</span>(<span class="var type1" id="S11T5U74">i</span>)</span>.mass</span>*<span class="mxinfo " id="T4:U57">eye(3)</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="39,48" id="srcline48">48</a></span><span class="line">    <span class="comment">%Add children contributions</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo " id="T64:U58"><span class="var type1" id="S13T64U81">child</span>=<span class="mxinfo " id="T64:U60"><span class="mxinfo " id="T65:U61">find(<span class="mxinfo " id="T16:U62"><span class="mxinfo " id="T15:U63"><span class="mxinfo " id="T14:U64"><span class="var type1" id="S8T19U88">robot</span>.con</span>.child</span>(<span class="mxinfo " id="T66:U66">:</span>,<span class="var type1" id="S11T5U92">i</span>)</span>)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="39,50" id="srcline50">50</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S15T5U95">j</span>=<span class="mxinfo " id="T65:U69"><span class="mxinfo " id="T5:U70">1</span>:<span class="mxinfo " id="T5:U71">length(<span class="var type1" id="S13T64U100">child</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="39,51" id="srcline51">51</a></span><span class="line">        <span class="mxinfo " id="T27:U73"><span class="mxinfo " id="T27:U74"><span class="var type1" id="S3T26U104">Mm_tilde</span>(<span class="mxinfo " id="T62:U76"><span class="mxinfo " id="T5:U77">1</span>:<span class="mxinfo " id="T5:U78">6</span></span>,<span class="mxinfo " id="T62:U79"><span class="mxinfo " id="T5:U80">1</span>:<span class="mxinfo " id="T5:U81">6</span></span>,<span class="var type1" id="S11T5U111">i</span>)</span>=<span class="mxinfo " id="T27:U83"><span class="mxinfo " id="T27:U84"><span class="var type1" id="S3T26U114">Mm_tilde</span>(<span class="mxinfo " id="T62:U86"><span class="mxinfo " id="T5:U87">1</span>:<span class="mxinfo " id="T5:U88">6</span></span>,<span class="mxinfo " id="T62:U89"><span class="mxinfo " id="T5:U90">1</span>:<span class="mxinfo " id="T5:U91">6</span></span>,<span class="var type1" id="S11T5U121">i</span>)</span>+<span class="mxinfo " id="T27:U93"><span class="mxinfo " id="T27:U94"><span class="mxinfo " id="T27:U95"><span class="mxinfo " id="T27:U96"><span class="var type1" id="S6T25U126">Bij</span>(<span class="mxinfo " id="T35:U98">1:6</span>,<span class="mxinfo " id="T35:U99">1:6</span>,<span class="mxinfo " id="T5:U100"><span class="var type1" id="S13T64U134">child</span>(<span class="var type1" id="S15T5U135">j</span>)</span>,<span class="var type1" id="S11T5U136">i</span>)</span>'</span>*<span class="mxinfo " id="T27:U104"><span class="var type1" id="S3T26U138">Mm_tilde</span>(<span class="mxinfo " id="T35:U106">1:6</span>,<span class="mxinfo " id="T35:U107">1:6</span>,<span class="mxinfo " id="T5:U108"><span class="var type1" id="S13T64U146">child</span>(<span class="var type1" id="S15T5U147">j</span>)</span>)</span></span>*<span class="mxinfo " id="T27:U111"><span class="var type1" id="S6T25U149">Bij</span>(<span class="mxinfo " id="T35:U113">1:6</span>,<span class="mxinfo " id="T35:U114">1:6</span>,<span class="mxinfo " id="T5:U115"><span class="var type1" id="S13T64U157">child</span>(<span class="var type1" id="S15T5U158">j</span>)</span>,<span class="var type1" id="S11T5U159">i</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="39,52" id="srcline52">52</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,53" id="srcline53">53</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,54" id="srcline54">54</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,55" id="srcline55">55</a></span><span class="line"><span class="comment">%Base-link M tilde</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,56" id="srcline56">56</a></span><span class="line"><span class="mxinfo " id="T27:U119"><span class="var type1" id="S2T27U162">M0_tilde</span>=<span class="mxinfo " id="T27:U121">[<span class="mxinfo " id="T63:U122"><span class="var type1" id="S4T4U165">I0</span>,<span class="mxinfo " id="T4:U124">zeros(<span class="mxinfo " id="T5:U125">3</span>,<span class="mxinfo " id="T5:U126">3</span>)</span></span>;<span class="mxinfo " id="T63:U127"><span class="mxinfo " id="T4:U128">zeros(<span class="mxinfo " id="T5:U129">3</span>,<span class="mxinfo " id="T5:U130">3</span>)</span>,<span class="mxinfo " id="T4:U131"><span class="mxinfo " id="T5:U132"><span class="var type1" id="S8T19U178">robot</span>.base_link.mass</span>*<span class="mxinfo " id="T4:U134">eye(3)</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="39,57" id="srcline57">57</a></span><span class="line"><span class="comment">%Add children contributions</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,58" id="srcline58">58</a></span><span class="line"><span class="mxinfo " id="T64:U135"><span class="var type1" id="S13T64U186">child</span>=<span class="mxinfo " id="T64:U137"><span class="mxinfo " id="T65:U138">find(<span class="var type1" id="S8T19U192">robot</span>.con.child_base)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="39,59" id="srcline59">59</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S15T5U197">j</span>=<span class="mxinfo " id="T65:U141"><span class="mxinfo " id="T5:U142">1</span>:<span class="mxinfo " id="T5:U143">length(<span class="var type1" id="S13T64U202">child</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="39,60" id="srcline60">60</a></span><span class="line">    <span class="mxinfo " id="T27:U145"><span class="var type1" id="S2T27U205">M0_tilde</span>=<span class="mxinfo " id="T27:U147"><span class="var type1" id="S2T27U207">M0_tilde</span>+<span class="mxinfo " id="T27:U149"><span class="mxinfo " id="T27:U150"><span class="mxinfo " id="T27:U151"><span class="mxinfo " id="T27:U152"><span class="var type1" id="S7T26U212">Bi0</span>(<span class="mxinfo " id="T35:U154">1:6</span>,<span class="mxinfo " id="T35:U155">1:6</span>,<span class="mxinfo " id="T5:U156"><span class="var type1" id="S13T64U220">child</span>(<span class="var type1" id="S15T5U221">j</span>)</span>)</span>'</span>*<span class="mxinfo " id="T27:U159"><span class="var type1" id="S3T26U223">Mm_tilde</span>(<span class="mxinfo " id="T35:U161">1:6</span>,<span class="mxinfo " id="T35:U162">1:6</span>,<span class="mxinfo " id="T5:U163"><span class="var type1" id="S13T64U231">child</span>(<span class="var type1" id="S15T5U232">j</span>)</span>)</span></span>*<span class="mxinfo " id="T27:U166"><span class="var type1" id="S7T26U234">Bi0</span>(<span class="mxinfo " id="T35:U168">1:6</span>,<span class="mxinfo " id="T35:U169">1:6</span>,<span class="mxinfo " id="T5:U170"><span class="var type1" id="S13T64U242">child</span>(<span class="var type1" id="S15T5U243">j</span>)</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="39,61" id="srcline61">61</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="39,62" id="srcline62">62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,63" id="srcline63">63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="39,64" id="srcline64">64</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
